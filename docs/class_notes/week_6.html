<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Corpus Studies in Music - Week 5: Regression and Clustering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../class_notes/week_5.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Corpus Studies in Music - Week 5: Regression and Clustering">
<meta property="og:description" content="">
<meta property="og:image" content="https://shanahdt.github.io/corpus-studies-2024/class_notes/week_6_files/figure-html/unnamed-chunk-3-1.png">
<meta property="og:site-name" content="Corpus Studies in Music">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../class_notes/week_1.html">Class Notes</a></li><li class="breadcrumb-item"><a href="../class_notes/week_6.html">Week 5: Regression and Clustering</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Corpus Studies in Music</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../some-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Some Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Class Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../class_notes/week_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1: Representing Musical Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../class_notes/week_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2: Melodic and Harmonic Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../class_notes/week_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3: Data Analysis, Time, Cadences, Phrases, <em>etc.</em></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../class_notes/week_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../class_notes/week_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5: Practicing with Spotify</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../class_notes/week_6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Week 5: Regression and Clustering</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#plan-for-the-week" id="toc-plan-for-the-week" class="nav-link active" data-scroll-target="#plan-for-the-week">Plan for the Week</a></li>
  <li><a href="#testing-a-hypothesis-with-continuous-data" id="toc-testing-a-hypothesis-with-continuous-data" class="nav-link" data-scroll-target="#testing-a-hypothesis-with-continuous-data">Testing a Hypothesis with Continuous Data</a></li>
  <li><a href="#hypothesis-1-do-billy-joels-songs-get-slower-over-time" id="toc-hypothesis-1-do-billy-joels-songs-get-slower-over-time" class="nav-link" data-scroll-target="#hypothesis-1-do-billy-joels-songs-get-slower-over-time">Hypothesis 1: Do Billy Joel’s Songs Get Slower Over Time?</a>
  <ul class="collapse">
  <li><a href="#looking-at-tempo-over-time" id="toc-looking-at-tempo-over-time" class="nav-link" data-scroll-target="#looking-at-tempo-over-time">Looking at tempo over time</a>
  <ul class="collapse">
  <li><a href="#post-hoc-analyses" id="toc-post-hoc-analyses" class="nav-link" data-scroll-target="#post-hoc-analyses">Post-Hoc Analyses</a></li>
  </ul></li>
  <li><a href="#sidenote-isare-the-data-normal" id="toc-sidenote-isare-the-data-normal" class="nav-link" data-scroll-target="#sidenote-isare-the-data-normal">Sidenote: Is/Are the data normal?</a></li>
  <li><a href="#stepwise-entry-regression" id="toc-stepwise-entry-regression" class="nav-link" data-scroll-target="#stepwise-entry-regression">Stepwise Entry Regression</a></li>
  <li><a href="#comparing-fits" id="toc-comparing-fits" class="nav-link" data-scroll-target="#comparing-fits">Comparing Fits:</a></li>
  <li><a href="#is-a-linear-model-the-best-approach" id="toc-is-a-linear-model-the-best-approach" class="nav-link" data-scroll-target="#is-a-linear-model-the-best-approach">Is a linear model the best approach?</a></li>
  <li><a href="#predicting-a-categorical-variable" id="toc-predicting-a-categorical-variable" class="nav-link" data-scroll-target="#predicting-a-categorical-variable">Predicting a categorical variable</a></li>
  </ul></li>
  <li><a href="#wednesday" id="toc-wednesday" class="nav-link" data-scroll-target="#wednesday">Wednesday</a>
  <ul class="collapse">
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a>
  <ul class="collapse">
  <li><a href="#how-does-the-r-hclust-function-work" id="toc-how-does-the-r-hclust-function-work" class="nav-link" data-scroll-target="#how-does-the-r-hclust-function-work">How does the R hclust function work?</a></li>
  </ul></li>
  <li><a href="#which-track-belongs-to-which-cluster" id="toc-which-track-belongs-to-which-cluster" class="nav-link" data-scroll-target="#which-track-belongs-to-which-cluster">Which track belongs to which cluster?</a>
  <ul class="collapse">
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-Means Clustering</a></li>
  </ul></li>
  <li><a href="#example-1-looking-at-nirvanas-unplugged-in-new-york" id="toc-example-1-looking-at-nirvanas-unplugged-in-new-york" class="nav-link" data-scroll-target="#example-1-looking-at-nirvanas-unplugged-in-new-york">Example 1: Looking at Nirvana’s <em>Unplugged in New York</em></a>
  <ul class="collapse">
  <li><a href="#k-means-clustering-1" id="toc-k-means-clustering-1" class="nav-link" data-scroll-target="#k-means-clustering-1">k-means clustering</a></li>
  </ul></li>
  <li><a href="#conditional-inference-tree-with-party" id="toc-conditional-inference-tree-with-party" class="nav-link" data-scroll-target="#conditional-inference-tree-with-party">Conditional Inference Tree with Party</a></li>
  <li><a href="#christmas-or-not" id="toc-christmas-or-not" class="nav-link" data-scroll-target="#christmas-or-not">Christmas or Not?</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/shanahdt/corpus-studies-2024/edit/main/class_notes/week_6.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/shanahdt/corpus-studies-2024/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 5: Regression and Clustering</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="plan-for-the-week" class="level1">
<h1>Plan for the Week</h1>
<p>This week, we will be going over:</p>
<ul>
<li>testing some basic hypotheses of continuous data with linear regression</li>
<li>testing some basic hypotheses of categorical data with logistic regressions</li>
<li>evaluating model fits</li>
</ul>
</section>
<section id="testing-a-hypothesis-with-continuous-data" class="level1">
<h1>Testing a Hypothesis with Continuous Data</h1>
<p>Although we’ve spent a fair bit of time going over the mechanics of the Spotify data, and how to extract information from it, we haven’t spent much time actually discussing testing hypotheses with your data. As many of you are doing hypothesis-based work for your final project, it might be a good time to step back and look some approaches to this.</p>
</section>
<section id="hypothesis-1-do-billy-joels-songs-get-slower-over-time" class="level1">
<h1>Hypothesis 1: Do Billy Joel’s Songs Get Slower Over Time?</h1>
<p>I think that Billy Joel’s songs are getting slower over time. Let’s test it.</p>
<p>We’ll start by grabbing our data. The spotify API seems to have changed recently, which broke the <code>get_artist_audio_features</code> function in <code>spotifyR</code>. Note how I had to fix it with the less-than-ideal artist URI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>billy_joel <span class="ot">&lt;-</span> <span class="fu">get_artist_audio_features</span>(<span class="st">'6zFYqv1mOsgBRQbae3JJ9e'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="looking-at-tempo-over-time" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-tempo-over-time">Looking at tempo over time</h2>
<p>We can start by eyeballing the data. Here is how we’d do it with base R (no ggplot/tidyverse):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tempo <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(tempo <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel), <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If we’d like to use <code>ggplot</code> it can give us some confidence bars (the default here is a 95% confidence interval):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billy_joel, <span class="fu">aes</span>(album_release_year, tempo) ) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So it looks promising. We can run a linear regression with a simple <code>lm</code> command. Here we can get a <code>summary</code> of the model pretty easily, as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(tempo <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = tempo ~ album_release_year, data = billy_joel)

Residuals:
    Min      1Q  Median      3Q     Max 
-82.632 -25.836  -0.508  23.329  68.277 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)        -53.02885  187.12869  -0.283    0.777
album_release_year   0.08637    0.09386   0.920    0.358

Residual standard error: 30.61 on 355 degrees of freedom
Multiple R-squared:  0.002379,  Adjusted R-squared:  -0.0004309 
F-statistic: 0.8467 on 1 and 355 DF,  p-value: 0.3581</code></pre>
</div>
</div>
<p>So, as we can see from the results here, it’s not significant (p &gt; .001), but it really doesn’t account for much of the variance (an adjusted R-squared of -.0004).</p>
<section id="post-hoc-analyses" class="level3">
<h3 class="anchored" data-anchor-id="post-hoc-analyses">Post-Hoc Analyses</h3>
<p>Perhaps we can look at how other variables might be predictive of the year of the recording.</p>
<p>Let’s look at how tempo, danceability, valence, speechiness, and energy might improve the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(album_release_year <span class="sc">~</span> tempo <span class="sc">+</span> danceability <span class="sc">+</span> valence <span class="sc">+</span> speechiness <span class="sc">+</span> energy, <span class="at">data=</span>billy_joel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = album_release_year ~ tempo + danceability + valence + 
    speechiness + energy, data = billy_joel)

Residuals:
    Min      1Q  Median      3Q     Max 
-29.376 -10.790  -0.305  10.294  36.338 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2002.16180    4.69463 426.479  &lt; 2e-16 ***
tempo          -0.02356    0.02566  -0.918    0.359    
danceability  -37.87836    7.40058  -5.118 5.09e-07 ***
valence       -19.21143    4.59097  -4.185 3.61e-05 ***
speechiness     1.47237    5.32909   0.276    0.782    
energy         30.68677    3.27153   9.380  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.24 on 351 degrees of freedom
Multiple R-squared:  0.331, Adjusted R-squared:  0.3214 
F-statistic: 34.73 on 5 and 351 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>So we have a more predictive model, with an adjusted R-squared of about .32.</p>
<p>There are some remaining questions, however. Firstly, is there covariance at play?</p>
<p>We can use the variance inflation factor (VIF) to look at this. Typically, each variable should be less than 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>billy_joel_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(album_release_year <span class="sc">~</span> tempo <span class="sc">+</span> danceability <span class="sc">+</span> valence <span class="sc">+</span> speechiness <span class="sc">+</span> energy, <span class="at">data=</span>billy_joel)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(billy_joel_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       tempo danceability      valence  speechiness       energy 
    1.082621     1.633266     1.950562     1.034647     1.309249 </code></pre>
</div>
</div>
<p>A correlation plot can help us to visualize this a bit more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>piano_man <span class="ot">&lt;-</span> billy_joel <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"acousticness"</span>, <span class="st">"liveness"</span>, <span class="st">"danceability"</span>, <span class="st">"loudness"</span>, <span class="st">"speechiness"</span>, <span class="st">"valence"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cor</span>(piano_man))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(x, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             acousticness liveness danceability loudness speechiness valence
acousticness         1.00    -0.22        -0.25    -0.63        0.14   -0.42
liveness            -0.22     1.00        -0.44     0.42        0.03   -0.14
danceability        -0.25    -0.44         1.00     0.00        0.06    0.56
loudness            -0.63     0.42         0.00     1.00       -0.41    0.31
speechiness          0.14     0.03         0.06    -0.41        1.00   -0.10
valence             -0.42    -0.14         0.56     0.31       -0.10    1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(x, <span class="at">method=</span><span class="st">"pie"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="sidenote-isare-the-data-normal" class="level2">
<h2 class="anchored" data-anchor-id="sidenote-isare-the-data-normal">Sidenote: Is/Are the data normal?</h2>
<p>We can test to see if the tempo data is normally distributed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(billy_joel<span class="sc">$</span>tempo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(billy_joel<span class="sc">$</span>tempo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(billy_joel<span class="sc">$</span>tempo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  billy_joel$tempo
W = 0.9806, p-value = 9.793e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ks.test</span>(billy_joel<span class="sc">$</span>tempo, <span class="st">"pnorm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ks.test.default(billy_joel$tempo, "pnorm"): ties should not be
present for the Kolmogorov-Smirnov test</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  billy_joel$tempo
D = 1, p-value &lt; 2.2e-16
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>At the moment, it doesn’t seem to be…</p>
</section>
<section id="stepwise-entry-regression" class="level2">
<h2 class="anchored" data-anchor-id="stepwise-entry-regression">Stepwise Entry Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">step</span>(<span class="fu">lm</span>(album_release_year <span class="sc">~</span> danceability <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>          tempo <span class="sc">+</span> acousticness <span class="sc">+</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>          speechiness <span class="sc">+</span> valence, <span class="at">data=</span>billy_joel), </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">direction=</span><span class="st">"backward"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1934.73
album_release_year ~ danceability + tempo + acousticness + speechiness + 
    valence

               Df Sum of Sq   RSS    AIC
- tempo         1      65.0 77993 1933.0
- speechiness   1     167.7 78095 1933.5
&lt;none&gt;                      77928 1934.7
- valence       1    1100.7 79028 1937.7
- acousticness  1   11065.4 88993 1980.1
- danceability  1   12221.7 90149 1984.7

Step:  AIC=1933.03
album_release_year ~ danceability + acousticness + speechiness + 
    valence

               Df Sum of Sq   RSS    AIC
- speechiness   1     170.5 78163 1931.8
&lt;none&gt;                      77993 1933.0
- valence       1    1239.9 79233 1936.7
- acousticness  1   11006.3 88999 1978.2
- danceability  1   12412.6 90405 1983.8

Step:  AIC=1931.81
album_release_year ~ danceability + acousticness + valence

               Df Sum of Sq   RSS    AIC
&lt;none&gt;                      78163 1931.8
- valence       1    1372.5 79536 1936.0
- acousticness  1   10836.8 89000 1976.2
- danceability  1   12256.3 90419 1981.8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = album_release_year ~ danceability + acousticness + 
    valence, data = billy_joel)

Residuals:
    Min      1Q  Median      3Q     Max 
-30.038 -12.131  -1.921  11.315  37.401 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2031.308      3.449 588.878  &lt; 2e-16 ***
danceability  -54.265      7.294  -7.440 7.74e-13 ***
acousticness  -19.751      2.823  -6.996 1.33e-11 ***
valence       -11.006      4.421  -2.490   0.0132 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.88 on 353 degrees of freedom
Multiple R-squared:  0.2651,    Adjusted R-squared:  0.2588 
F-statistic: 42.44 on 3 and 353 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">step</span>(<span class="fu">lm</span>(album_release_year <span class="sc">~</span> danceability <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>          tempo <span class="sc">+</span> acousticness <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>          speechiness <span class="sc">+</span> valence, <span class="at">data=</span>billy_joel), </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">direction=</span><span class="st">"forward"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1934.73
album_release_year ~ danceability + tempo + acousticness + speechiness + 
    valence</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = album_release_year ~ danceability + tempo + acousticness + 
    speechiness + valence, data = billy_joel)

Residuals:
   Min     1Q Median     3Q    Max 
-29.57 -12.43  -1.62  11.50  37.91 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2033.1925     5.0614 401.707  &lt; 2e-16 ***
danceability  -56.1173     7.5635  -7.419 8.94e-13 ***
tempo          -0.0145     0.0268  -0.541   0.5887    
acousticness  -20.1919     2.8601  -7.060 8.98e-12 ***
speechiness     4.8770     5.6116   0.869   0.3854    
valence       -10.0944     4.5335  -2.227   0.0266 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.9 on 351 degrees of freedom
Multiple R-squared:  0.2673,    Adjusted R-squared:  0.2569 
F-statistic: 25.61 on 5 and 351 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="comparing-fits" class="level2">
<h2 class="anchored" data-anchor-id="comparing-fits">Comparing Fits:</h2>
<p>We could construct a few models But how can we tell which of these is more predictable? For this, we can look at <strong>Akaike’s ‘An Information Criterion’</strong>(or AIC). The lower number is better, and any difference of more than 2 is considered a statistically significant difference fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dance_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(danceability <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>acoustic_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(acousticness <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>speech_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(speechiness <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>valence_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(valence <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>tempo_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(tempo <span class="sc">~</span> album_release_year, <span class="at">data=</span>billy_joel)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>combined_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(album_release_year <span class="sc">~</span> tempo <span class="sc">+</span> acousticness <span class="sc">+</span> speechiness <span class="sc">+</span> valence, <span class="at">data=</span>billy_joel)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(dance_model, </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    acoustic_model, </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    tempo_model,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    speech_model, </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    valence_model, </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    combined_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               df        AIC
dance_model     3 -500.47993
acoustic_model  3  163.75641
tempo_model     3 3459.95593
speech_model    3 -365.56978
valence_model   3  -51.44052
combined_model  6 2999.86297</code></pre>
</div>
</div>
<p>The combined model doesn’t seem to do terribly well here, which seems to muddy the question up a bit. There are some interesting points here with tempo, valence, acoustic, and speech, though.</p>
</section>
<section id="is-a-linear-model-the-best-approach" class="level2">
<h2 class="anchored" data-anchor-id="is-a-linear-model-the-best-approach">Is a linear model the best approach?</h2>
<p>We can adjust how we are viewing this data (linear or polynomial fit) a bit with the code below. Here we can plot our data as a line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billy_joel, <span class="fu">aes</span>(album_release_year, tempo) ) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> lm, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">1</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And here we have it as a second order polynomial:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(billy_joel, <span class="fu">aes</span>(album_release_year, tempo) ) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> lm, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And we can compare fits here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(album_release_year <span class="sc">~</span> tempo, <span class="at">data =</span> billy_joel)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>poly_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(album_release_year <span class="sc">~</span> tempo <span class="sc">+</span> <span class="fu">I</span>(album_release_year<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> billy_joel)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(linear, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    poly_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       df       AIC
linear  3  3052.039
poly_2  4 -1041.695</code></pre>
</div>
</div>
<p>So it looks like a polynomial fit is a better one, but still isn’t that great.</p>
</section>
<section id="predicting-a-categorical-variable" class="level2">
<h2 class="anchored" data-anchor-id="predicting-a-categorical-variable">Predicting a categorical variable</h2>
<p>What does it look like to predict a categorical variable in R? We might explore this question by hypothesizing that musical features might be predictive of mode (labeled in Spotify as major or minor: 1 or 0).</p>
<p>Here is what a binomial logistic regression would look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>billy_joel.log <span class="ot">&lt;-</span> <span class="fu">glm</span>(mode <span class="sc">~</span> tempo <span class="sc">+</span> danceability <span class="sc">+</span> valence <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                     speechiness <span class="sc">+</span> acousticness, <span class="at">family =</span> binomial, <span class="at">data =</span> billy_joel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And it looks like “speechiness” is the most predictive of mode here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(billy_joel.log)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = mode ~ tempo + danceability + valence + speechiness + 
    acousticness, family = binomial, data = billy_joel)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4202   0.3895   0.4728   0.5709   1.0682  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   4.413208   1.060553   4.161 3.17e-05 ***
tempo        -0.006563   0.005367  -1.223   0.2214    
danceability -3.572894   1.499965  -2.382   0.0172 *  
valence       1.175420   0.882904   1.331   0.1831    
speechiness  -0.596981   0.877367  -0.680   0.4962    
acousticness -1.336813   0.563678  -2.372   0.0177 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 289.22  on 356  degrees of freedom
Residual deviance: 274.08  on 351  degrees of freedom
AIC: 286.08

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>We can plot the log odds ratios as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">confint</span>(billy_joel.log))[<span class="sc">-</span><span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(billy_joel.log,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">axis.lim =</span> <span class="fu">c</span>(<span class="fu">min</span>(CI), <span class="fu">max</span>(CI)),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">auto.label =</span> F,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">show.values =</span> T) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="wednesday" class="level1">
<h1>Wednesday</h1>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<p>Cluster analysis is a form of statistical data analysis in which subsets (called “clusters”) are formed according to some notion of similarity. There are many different variants of cluster analysis, but most are hierarchical–in which low-level clusters are successively joined together to make larger clusters, and so on, until everything is clustered into one large group. The result is a cluster tree or <em>dendrogram</em>.</p>
<section id="how-does-the-r-hclust-function-work" class="level3">
<h3 class="anchored" data-anchor-id="how-does-the-r-hclust-function-work">How does the R hclust function work?</h3>
<p>The <strong>hclust</strong> function is part of the default package in R, and it clusters based on dissimilarities in the data. There are different algorithms it can use, but the default is <a href="https://www.rdocumentation.org/packages/stats/versions/3.5.3/topics/hclust">Ward’s minimum variance</a>. It requires some distance to be calculated first, so the <a href="https://www.rdocumentation.org/packages/stats/versions/3.5.3/topics/dist"><em>dist</em></a> function is used on the data. Again there are many options here, but the default is to simply calculate the Euclidean distance between the values.</p>
<p>The documentation states:</p>
<blockquote class="blockquote">
<p>This function performs a hierarchical cluster analysis using a set of dissimilarities for the <em>n</em> objects being clustered. Initially, each object is assigned to its own cluster and then the algorithm proceeds iteratively, at each stage joining the two most similar clusters, continuing until there is just a single cluster. At each stage distances between clusters are recomputed by the Lance–Williams dissimilarity update formula according to the particular clustering method being used.</p>
</blockquote>
<p>The default is Ward’s minimum variance method, which:</p>
<blockquote class="blockquote">
<p>aims at finding compact, spherical clusters. The complete linkage method finds similar clusters.</p>
</blockquote>
<p>Another method is the “single linkage method”.</p>
<blockquote class="blockquote">
<p>The single linkage method (which is closely related to the minimal spanning tree) adopts a ‘friends of friends’ clustering strategy. The other methods can be regarded as aiming for clusters with characteristics somewhere between the single and complete link methods. Note however, that methods “median” and “centroid” are not leading to a monotone distance measure, or equivalently the resulting dendrograms can have so called inversions or reversals which are hard to interpret, but note the trichotomies in Legendre and Legendre (2012).</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster demo modified from here: </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="do">### https://www.r-bloggers.com/2021/04/cluster-analysis-in-r/</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>beyonce <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/beyonce.csv"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>taylor <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/taylor.csv"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> beyonce <span class="sc">|&gt;</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(album_name <span class="sc">==</span> <span class="st">"4"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"track_name"</span>, <span class="st">"acousticness"</span>, <span class="st">"liveness"</span>, <span class="st">"danceability"</span>, <span class="st">"loudness"</span>, <span class="st">"speechiness"</span>, <span class="st">"valence"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">distinct</span>(track_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="do">## cleaning up the data.</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> df[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="do">### getting means of each category.</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">apply</span>(z,<span class="dv">2</span>,mean)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="do">### getting standard deviation of each category.</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(z,<span class="dv">2</span>,sd)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="do">### scales the data in the matrix.</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(z,<span class="at">center=</span>means,<span class="at">scale=</span>sds)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can plot the data like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">### helps with the size of the image.</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">### creates the cluster</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>df.hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(distance)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">### plots the data but with row numbers.</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df.hclust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And we can add the track name like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df.hclust,<span class="at">labels=</span>df<span class="sc">$</span>track_name,<span class="at">main=</span><span class="st">'Default from hclust'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can clean up the plot the be along a single x-axis with the <code>hang</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>nodePar <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">lab.cex =</span> <span class="fl">0.6</span>, <span class="at">pch =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">19</span>), </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df.hclust,<span class="at">hang=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">labels=</span>df<span class="sc">$</span>track_name,<span class="at">main=</span><span class="st">'Default from hclust'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="which-track-belongs-to-which-cluster" class="level2">
<h2 class="anchored" data-anchor-id="which-track-belongs-to-which-cluster">Which track belongs to which cluster?</h2>
<p>It might be helpful with this analysis to look at how each of the songs fits on the tree. We can use the <code>cutree</code> function, which “cuts a tree” from the cluster based on how many groups we ask it for.</p>
<p>The following code can tell us how many fall into each broader tree, assuming we think that the tree should be cut into three. Notice that the third branch is the most populous, with the second being the most sparsely populated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>member <span class="ot">&lt;-</span> <span class="fu">cutree</span>(df.hclust,<span class="dv">3</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(member)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>member
 1  2  3 
 4  3 11 </code></pre>
</div>
</div>
<p>But how is each category being weighted? The code below shows that acousticness and danceability do a fair bit of work in separating groups 1 and 3, and valence separates 1 and 2 from one another.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">##but how are these clusters calculated?</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(scaled_data,<span class="fu">list</span>(member),mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group.1 acousticness   liveness danceability   loudness speechiness
1       1    1.2293770 -0.3037203   -1.5341655 -0.4289046   0.3971934
2       2    0.6165508 -0.5097641    0.5152708 -1.0002027   1.0862774
3       3   -0.6151964  0.2494703    0.4173500  0.4287478  -0.4406914
     valence
1 -1.2506018
2  1.0310423
3  0.1735709</code></pre>
</div>
</div>
<p>A slightly more even split occurs if we break it into four groups rather than three.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>member <span class="ot">&lt;-</span> <span class="fu">cutree</span>(df.hclust,<span class="dv">4</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(member)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>member
1 2 3 4 
4 3 9 2 </code></pre>
</div>
</div>
<p>And that how they’re split into four is a bit different from how we might split them into three, but danceability and acousticness still playing a strong role.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(scaled_data,<span class="fu">list</span>(member),mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group.1 acousticness   liveness danceability   loudness speechiness
1       1    1.2293770 -0.3037203   -1.5341655 -0.4289046   0.3971934
2       2    0.6165508 -0.5097641    0.5152708 -1.0002027   1.0862774
3       3   -0.6115250 -0.1547202    0.4044253  0.3613888  -0.5628163
4       4   -0.6317177  2.0683279    0.4755110  0.7318636   0.1088705
      valence
1 -1.25060184
2  1.03104230
3  0.05196371
4  0.72080353</code></pre>
</div>
</div>
<section id="k-means-clustering" class="level3">
<h3 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h3>
<p>We can also run a simple k-means clustering on the data. With this, we are clustering the data into <em>k</em> groups. R’s documentation explains it like so:</p>
<blockquote class="blockquote">
<p>aims to partition the points into <em>k</em> groups such that the sum of squares from points to the assigned cluster centres is minimized. At the minimum, all cluster centres are at the mean of their Voronoi sets (the set of data points which are nearest to the cluster centre).</p>
</blockquote>
<p>There are a few algorithms to pick from. R uses the Hartigan and Wong (1979) algorithm by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">###split it into three groups</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>kc <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data,<span class="dv">3</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="do">### add labels.</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(scaled_data) <span class="ot">&lt;-</span> df<span class="sc">$</span>track_name</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="do">###get the shortest distance.</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>datadistshortset<span class="ot">&lt;-</span><span class="fu">dist</span>(scaled_data,<span class="at">method =</span> <span class="st">"euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code below will cluster it based on this k-means clustering distance, and plot them into the amount of groups listed (here 3).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>hc1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(datadistshortset, <span class="at">method =</span> <span class="st">"complete"</span> )</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>pamvshortset <span class="ot">&lt;-</span> <span class="fu">pam</span>(datadistshortset,<span class="dv">3</span>, <span class="at">diss =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">clusplot</span>(pamvshortset, <span class="at">shade =</span> <span class="cn">FALSE</span>,<span class="at">labels=</span><span class="dv">2</span>,<span class="at">col.clus=</span><span class="st">"blue"</span>,<span class="at">col.p=</span><span class="st">"red"</span>,<span class="at">span=</span><span class="cn">FALSE</span>,<span class="at">main=</span><span class="st">"Cluster Mapping"</span>,<span class="at">cex=</span><span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="example-1-looking-at-nirvanas-unplugged-in-new-york" class="level2">
<h2 class="anchored" data-anchor-id="example-1-looking-at-nirvanas-unplugged-in-new-york">Example 1: Looking at Nirvana’s <em>Unplugged in New York</em></h2>
<p>I’m going to get the global features from Nirvana’s <em>Unplugged in New York</em> album:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the album tracks</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>album_id <span class="ot">&lt;-</span> <span class="st">"1To7kv722A8SpZF789MZy7"</span>  <span class="co"># This is the Spotify ID for "MTV Unplugged In New York"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="do">##get all the tracks.</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>album_tracks <span class="ot">&lt;-</span> <span class="fu">get_album_tracks</span>(album_id)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all of the audo features.</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>audio_features <span class="ot">&lt;-</span> <span class="fu">get_track_audio_features</span>(album_tracks<span class="sc">$</span>id)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the tracks with the features.</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>nirvana_unplugged <span class="ot">&lt;-</span> <span class="fu">left_join</span>(album_tracks, audio_features, <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gets lots of data, and I’m just interested in their global measures (tempo, danceability, liveness, etc.). Here, I’ve gone with column number rather than name, but the other version might be a bit easier/cleaner. Nevertheless, this is another way of doing it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">### This subsets the data based on only the columns I want.</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>nirvana_unplugged_data <span class="ot">&lt;-</span> nirvana_unplugged <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(danceability, energy, loudness, speechiness, tempo, valence, acousticness, instrumentalness, energy)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="do">### I assign the track name column (30) with the rownames, to have a labeled cluster.</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(nirvana_unplugged_data) <span class="ot">&lt;-</span> nirvana_unplugged<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(nirvana_unplugged_data), <span class="at">method =</span> <span class="st">"complete"</span>, <span class="at">members =</span> <span class="cn">NULL</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="plotting-the-cluster" class="level4">
<h4 class="anchored" data-anchor-id="plotting-the-cluster">Plotting the cluster</h4>
<p>Technically, you could just use the plot function at this point, but there are some long title names, so I added these extra plot options to make the text smaller and increase the marins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">labels =</span>  <span class="fu">row.names</span>(nirvana_unplugged_data),<span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>, <span class="at">main=</span><span class="st">""</span>, <span class="at">sub=</span><span class="st">""</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex=</span><span class="dv">1</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">xlab=</span><span class="st">"tunes"</span>, <span class="at">ylab=</span><span class="st">"height"</span>, <span class="at">main=</span><span class="st">"Nirvana unplugged"</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot is a bit strange now, as we have a pretty big negative number on the y-axis. Nevertheless, we see some cool things. The songs written by the Meat Puppets cluster together, for example.</p>
</section>
<section id="k-means-clustering-1" class="level3">
<h3 class="anchored" data-anchor-id="k-means-clustering-1">k-means clustering</h3>
<p>Our next type of clustering analysis is be a <strong>k-means cluster</strong>. We will start off by using a <a href="https://en.wikipedia.org/wiki/Scree_plot">scree plot</a> to see how many clusters we should use. There are a number of ways of analyzing where an “elbow” on this plot might be, but many people actually just eyeball it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>titles <span class="ot">&lt;-</span> nirvana_unplugged<span class="sc">$</span>name</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>nirvana_unplugged_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(nirvana_unplugged_data[,<span class="sc">-</span><span class="dv">10</span>]) <span class="co"># standardize variables</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>nirvana_unplugged_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(nirvana_unplugged_data) <span class="co"># standardize variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine number of clusters</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(nirvana_unplugged_data)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">sum</span>(<span class="fu">apply</span>(nirvana_unplugged_data,<span class="dv">2</span>,var))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) wss[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(nirvana_unplugged_data, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">centers=</span>i)<span class="sc">$</span>withinss)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, wss, <span class="at">type=</span><span class="st">"b"</span>, <span class="at">xlab=</span><span class="st">"Number of Clusters"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">"Within groups sum of squares"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And now we can look at the k-means clustering based on however many clusters we think are necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># K-Means Cluster Analysis</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(nirvana_unplugged_data, <span class="dv">3</span>) <span class="co"># 3 cluster solution</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get cluster means </span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(nirvana_unplugged_data,<span class="at">by=</span><span class="fu">list</span>(fit<span class="sc">$</span>cluster),<span class="at">FUN=</span>mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group.1 danceability     energy   loudness speechiness      tempo     valence
1       1   -0.5625808  0.4212425  0.5351353   0.5578725  0.6479399 -0.04483405
2       2   -0.7610397 -0.9842223 -1.5210813   0.1617592 -1.3717591 -0.91001724
3       3    0.8493372  0.1410757  0.3145946  -0.5457733  0.1459297  0.49237033
  acousticness instrumentalness
1   -1.0817044       -0.3337712
2    0.7858082        0.9230788
3    0.5085162       -0.1833967</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># append cluster assignment</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>unplugged_appended <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(nirvana_unplugged_data, fit<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(unplugged_appended) <span class="ot">=</span> titles</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clusplot</span>(unplugged_appended, fit<span class="sc">$</span>cluster, <span class="at">color=</span><span class="cn">TRUE</span>, <span class="at">shade=</span><span class="cn">TRUE</span>, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">labels=</span><span class="dv">3</span>, <span class="at">lines=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="conditional-inference-tree-with-party" class="level2">
<h2 class="anchored" data-anchor-id="conditional-inference-tree-with-party">Conditional Inference Tree with Party</h2>
<p>A conditional inference tree is basically a regression tree, and it tells you exactly how it picks apart the data in a pretty clear way.</p>
<p>I’ve always thought that Weezer was a bit derivative, so we might look at how we can separate them other (much better) bands, like Pavement…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">###gets around the spotify API limitations of 100.</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>split_into_chunks <span class="ot">&lt;-</span> <span class="cf">function</span>(track_ids, <span class="at">chunk_size =</span> <span class="dv">100</span>) {</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(track_ids, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(track_ids) <span class="sc">/</span> chunk_size))</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="do">###gets tracks from pavement and weezer albums, and all of their features.</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>pavement_albums <span class="ot">&lt;-</span> <span class="fu">get_artist_albums</span>(<span class="st">'3inCNiUr4R6XQ3W43s9Aqi'</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>pavement_tracks <span class="ot">&lt;-</span> <span class="fu">map_df</span>(pavement_albums<span class="sc">$</span>id, get_album_tracks)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>weezer_albums <span class="ot">&lt;-</span> <span class="fu">get_artist_albums</span>(<span class="st">'3jOstUTkEu2JkjvRdBA5Gu'</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>weezer_tracks <span class="ot">&lt;-</span> <span class="fu">map_df</span>(weezer_albums<span class="sc">$</span>id, get_album_tracks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="do">##splits into chunks and gets the audio data for weezer</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>weezer_track_id_chunks <span class="ot">&lt;-</span> <span class="fu">split_into_chunks</span>(weezer_tracks<span class="sc">$</span>id)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>weezer_audio_features_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weezer_track_id_chunks, get_track_audio_features)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="do">##splits into chunks and gets the audio data for pavement</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>pavement_track_id_chunks <span class="ot">&lt;-</span> <span class="fu">split_into_chunks</span>(pavement_tracks<span class="sc">$</span>id)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>pavement_audio_features_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(pavement_track_id_chunks, get_track_audio_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the list of data frames into a single data frame for both artists</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>weezer_audio_features <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, weezer_audio_features_list)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>pavement_audio_features <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, pavement_audio_features_list)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>weezer_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(weezer_tracks, weezer_audio_features, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>pavement_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(pavement_tracks, pavement_audio_features, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>pavement_data<span class="sc">$</span>artist <span class="ot">&lt;-</span> <span class="st">"Pavement"</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>weezer_data<span class="sc">$</span>artist <span class="ot">&lt;-</span> <span class="st">"Weezer"</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>pavement <span class="ot">&lt;-</span> pavement_data <span class="sc">|&gt;</span> <span class="fu">select</span>(artist, danceability, energy, key, loudness, speechiness, acousticness, instrumentalness, liveness, valence, tempo)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>weezer <span class="ot">&lt;-</span> weezer_data <span class="sc">|&gt;</span> <span class="fu">select</span>(artist, danceability, energy, key, loudness, speechiness, acousticness, instrumentalness, liveness, valence, tempo)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>pavement_weezer <span class="ot">&lt;-</span><span class="fu">rbind</span>(pavement, weezer)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>pavement_weezer <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pavement_weezer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a regression tree that tries to account for the variance between deciding whether a piece is from Pavement or Weezer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rpart</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grow tree </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">as.factor</span>(artist) <span class="sc">~</span> danceability <span class="sc">+</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>              valence <span class="sc">+</span> tempo <span class="sc">+</span> liveness,  <span class="at">data=</span>pavement_weezer)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(fit) <span class="co"># display the results </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = as.factor(artist) ~ danceability + valence + 
    tempo + liveness, data = pavement_weezer)

Variables actually used in tree construction:
[1] danceability liveness     tempo        valence     

Root node error: 245/523 = 0.46845

n= 523 

        CP nsplit rel error  xerror     xstd
1 0.297959      0   1.00000 1.00000 0.046579
2 0.020408      1   0.70204 0.75510 0.044630
3 0.018367      6   0.60000 0.76735 0.044790
4 0.016327      8   0.56327 0.75102 0.044575
5 0.012245     10   0.53061 0.75102 0.044575
6 0.011224     12   0.50612 0.72653 0.044229
7 0.010000     17   0.44082 0.73469 0.044347</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(fit) <span class="co"># visualize cross-validation results </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit) <span class="co"># detailed summary of splits</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = as.factor(artist) ~ danceability + valence + 
    tempo + liveness, data = pavement_weezer)
  n= 523 

          CP nsplit rel error    xerror       xstd
1 0.29795918      0 1.0000000 1.0000000 0.04657882
2 0.02040816      1 0.7020408 0.7551020 0.04463004
3 0.01836735      6 0.6000000 0.7673469 0.04479034
4 0.01632653      8 0.5632653 0.7510204 0.04457505
5 0.01224490     10 0.5306122 0.7510204 0.04457505
6 0.01122449     12 0.5061224 0.7265306 0.04422854
7 0.01000000     17 0.4408163 0.7346939 0.04434722

Variable importance
danceability        tempo      valence     liveness 
          37           26           21           15 

Node number 1: 523 observations,    complexity param=0.2979592
  predicted class=Pavement  expected loss=0.4684512  P(node) =1
    class counts:   278   245
   probabilities: 0.532 0.468 
  left son=2 (276 obs) right son=3 (247 obs)
  Primary splits:
      danceability &lt; 0.4725   to the left,  improve=30.101410, (0 missing)
      valence      &lt; 0.192    to the left,  improve= 6.770815, (0 missing)
      liveness     &lt; 0.0561   to the right, improve= 5.761035, (0 missing)
      tempo        &lt; 142.1145 to the right, improve= 5.082890, (0 missing)
  Surrogate splits:
      valence  &lt; 0.518    to the left,  agree=0.641, adj=0.239, (0 split)
      tempo    &lt; 136.195  to the right, agree=0.606, adj=0.166, (0 split)
      liveness &lt; 0.0561   to the right, agree=0.539, adj=0.024, (0 split)

Node number 2: 276 observations,    complexity param=0.02040816
  predicted class=Pavement  expected loss=0.307971  P(node) =0.5277247
    class counts:   191    85
   probabilities: 0.692 0.308 
  left son=4 (135 obs) right son=5 (141 obs)
  Primary splits:
      tempo        &lt; 125.6825 to the left,  improve=4.586456, (0 missing)
      valence      &lt; 0.462    to the right, improve=3.868215, (0 missing)
      danceability &lt; 0.3985   to the left,  improve=3.317837, (0 missing)
      liveness     &lt; 0.587    to the right, improve=2.857358, (0 missing)
  Surrogate splits:
      valence      &lt; 0.462    to the right, agree=0.591, adj=0.163, (0 split)
      danceability &lt; 0.3295   to the right, agree=0.569, adj=0.119, (0 split)
      liveness     &lt; 0.3165   to the right, agree=0.569, adj=0.119, (0 split)

Node number 3: 247 observations,    complexity param=0.02040816
  predicted class=Weezer    expected loss=0.3522267  P(node) =0.4722753
    class counts:    87   160
   probabilities: 0.352 0.648 
  left son=6 (50 obs) right son=7 (197 obs)
  Primary splits:
      valence      &lt; 0.3135   to the left,  improve=4.420774, (0 missing)
      tempo        &lt; 142.4715 to the right, improve=3.415253, (0 missing)
      liveness     &lt; 0.3515   to the left,  improve=3.319289, (0 missing)
      danceability &lt; 0.522    to the left,  improve=3.156231, (0 missing)

Node number 4: 135 observations,    complexity param=0.01836735
  predicted class=Pavement  expected loss=0.2148148  P(node) =0.2581262
    class counts:   106    29
   probabilities: 0.785 0.215 
  left son=8 (96 obs) right son=9 (39 obs)
  Primary splits:
      tempo        &lt; 91.104   to the right, improve=4.189779, (0 missing)
      liveness     &lt; 0.311    to the right, improve=3.744537, (0 missing)
      valence      &lt; 0.5385   to the right, improve=1.336445, (0 missing)
      danceability &lt; 0.21     to the right, improve=0.436410, (0 missing)
  Surrogate splits:
      danceability &lt; 0.2455   to the right, agree=0.756, adj=0.154, (0 split)
      valence      &lt; 0.04065  to the right, agree=0.748, adj=0.128, (0 split)
      liveness     &lt; 0.913    to the left,  agree=0.719, adj=0.026, (0 split)

Node number 5: 141 observations,    complexity param=0.02040816
  predicted class=Pavement  expected loss=0.3971631  P(node) =0.2695985
    class counts:    85    56
   probabilities: 0.603 0.397 
  left son=10 (93 obs) right son=11 (48 obs)
  Primary splits:
      danceability &lt; 0.405    to the left,  improve=6.236817, (0 missing)
      valence      &lt; 0.192    to the left,  improve=4.284825, (0 missing)
      liveness     &lt; 0.1585   to the left,  improve=3.346640, (0 missing)
      tempo        &lt; 173.12   to the right, improve=3.191540, (0 missing)
  Surrogate splits:
      tempo    &lt; 136.6285 to the right, agree=0.766, adj=0.313, (0 split)
      liveness &lt; 0.1004   to the right, agree=0.688, adj=0.083, (0 split)
      valence  &lt; 0.552    to the left,  agree=0.667, adj=0.021, (0 split)

Node number 6: 50 observations,    complexity param=0.02040816
  predicted class=Pavement  expected loss=0.46  P(node) =0.09560229
    class counts:    27    23
   probabilities: 0.540 0.460 
  left son=12 (16 obs) right son=13 (34 obs)
  Primary splits:
      valence      &lt; 0.279    to the right, improve=3.494412, (0 missing)
      liveness     &lt; 0.117    to the left,  improve=3.494412, (0 missing)
      danceability &lt; 0.545    to the left,  improve=1.883478, (0 missing)
      tempo        &lt; 122.7905 to the left,  improve=1.830476, (0 missing)
  Surrogate splits:
      tempo    &lt; 99.264   to the left,  agree=0.72, adj=0.125, (0 split)
      liveness &lt; 0.483    to the right, agree=0.72, adj=0.125, (0 split)

Node number 7: 197 observations,    complexity param=0.01632653
  predicted class=Weezer    expected loss=0.3045685  P(node) =0.376673
    class counts:    60   137
   probabilities: 0.305 0.695 
  left son=14 (18 obs) right son=15 (179 obs)
  Primary splits:
      tempo        &lt; 145.2105 to the right, improve=3.723037, (0 missing)
      danceability &lt; 0.7155   to the right, improve=3.449435, (0 missing)
      liveness     &lt; 0.3925   to the left,  improve=3.325543, (0 missing)
      valence      &lt; 0.6665   to the right, improve=1.613554, (0 missing)

Node number 8: 96 observations
  predicted class=Pavement  expected loss=0.1354167  P(node) =0.1835564
    class counts:    83    13
   probabilities: 0.865 0.135 

Node number 9: 39 observations,    complexity param=0.01836735
  predicted class=Pavement  expected loss=0.4102564  P(node) =0.07456979
    class counts:    23    16
   probabilities: 0.590 0.410 
  left son=18 (20 obs) right son=19 (19 obs)
  Primary splits:
      liveness     &lt; 0.164    to the right, improve=7.903374, (0 missing)
      tempo        &lt; 77.903   to the left,  improve=3.938462, (0 missing)
      valence      &lt; 0.489    to the left,  improve=1.538462, (0 missing)
      danceability &lt; 0.4325   to the left,  improve=1.038462, (0 missing)
  Surrogate splits:
      danceability &lt; 0.4295   to the left,  agree=0.692, adj=0.368, (0 split)
      tempo        &lt; 79.1165  to the left,  agree=0.667, adj=0.316, (0 split)
      valence      &lt; 0.06715  to the left,  agree=0.615, adj=0.211, (0 split)

Node number 10: 93 observations,    complexity param=0.01122449
  predicted class=Pavement  expected loss=0.2903226  P(node) =0.1778203
    class counts:    66    27
   probabilities: 0.710 0.290 
  left son=20 (28 obs) right son=21 (65 obs)
  Primary splits:
      liveness     &lt; 0.1325   to the left,  improve=3.839064, (0 missing)
      valence      &lt; 0.467    to the right, improve=2.698114, (0 missing)
      tempo        &lt; 137.6275 to the left,  improve=1.579362, (0 missing)
      danceability &lt; 0.249    to the right, improve=1.275376, (0 missing)
  Surrogate splits:
      valence &lt; 0.192    to the left,  agree=0.796, adj=0.321, (0 split)
      tempo   &lt; 171.5065 to the right, agree=0.742, adj=0.143, (0 split)

Node number 11: 48 observations,    complexity param=0.0122449
  predicted class=Weezer    expected loss=0.3958333  P(node) =0.0917782
    class counts:    19    29
   probabilities: 0.396 0.604 
  left son=22 (36 obs) right son=23 (12 obs)
  Primary splits:
      liveness     &lt; 0.232    to the left,  improve=3.125000, (0 missing)
      danceability &lt; 0.446    to the right, improve=2.858333, (0 missing)
      tempo        &lt; 135.3625 to the right, improve=1.608768, (0 missing)
      valence      &lt; 0.47     to the right, improve=0.939358, (0 missing)
  Surrogate splits:
      danceability &lt; 0.4235   to the right, agree=0.833, adj=0.333, (0 split)
      tempo        &lt; 126.185  to the right, agree=0.812, adj=0.250, (0 split)

Node number 12: 16 observations
  predicted class=Pavement  expected loss=0.1875  P(node) =0.03059273
    class counts:    13     3
   probabilities: 0.813 0.187 

Node number 13: 34 observations,    complexity param=0.02040816
  predicted class=Weezer    expected loss=0.4117647  P(node) =0.06500956
    class counts:    14    20
   probabilities: 0.412 0.588 
  left son=26 (9 obs) right son=27 (25 obs)
  Primary splits:
      liveness     &lt; 0.113    to the left,  improve=3.279477, (0 missing)
      danceability &lt; 0.5015   to the left,  improve=2.409982, (0 missing)
      valence      &lt; 0.252    to the left,  improve=1.719600, (0 missing)
      tempo        &lt; 122.7905 to the left,  improve=1.719600, (0 missing)
  Surrogate splits:
      tempo &lt; 133.5595 to the right, agree=0.824, adj=0.333, (0 split)

Node number 14: 18 observations
  predicted class=Pavement  expected loss=0.3888889  P(node) =0.03441683
    class counts:    11     7
   probabilities: 0.611 0.389 

Node number 15: 179 observations,    complexity param=0.01632653
  predicted class=Weezer    expected loss=0.273743  P(node) =0.3422562
    class counts:    49   130
   probabilities: 0.274 0.726 
  left son=30 (14 obs) right son=31 (165 obs)
  Primary splits:
      danceability &lt; 0.7155   to the right, improve=4.138552, (0 missing)
      liveness     &lt; 0.07975  to the right, improve=2.633307, (0 missing)
      tempo        &lt; 103.7565 to the right, improve=1.880171, (0 missing)
      valence      &lt; 0.6665   to the right, improve=1.309757, (0 missing)

Node number 18: 20 observations
  predicted class=Pavement  expected loss=0.1  P(node) =0.03824092
    class counts:    18     2
   probabilities: 0.900 0.100 

Node number 19: 19 observations
  predicted class=Weezer    expected loss=0.2631579  P(node) =0.03632887
    class counts:     5    14
   probabilities: 0.263 0.737 

Node number 20: 28 observations
  predicted class=Pavement  expected loss=0.07142857  P(node) =0.05353728
    class counts:    26     2
   probabilities: 0.929 0.071 

Node number 21: 65 observations,    complexity param=0.01122449
  predicted class=Pavement  expected loss=0.3846154  P(node) =0.124283
    class counts:    40    25
   probabilities: 0.615 0.385 
  left son=42 (14 obs) right son=43 (51 obs)
  Primary splits:
      valence      &lt; 0.467    to the right, improve=3.500323, (0 missing)
      tempo        &lt; 135.526  to the left,  improve=3.496503, (0 missing)
      liveness     &lt; 0.268    to the right, improve=1.782744, (0 missing)
      danceability &lt; 0.2515   to the right, improve=1.454810, (0 missing)
  Surrogate splits:
      tempo &lt; 127.1735 to the left,  agree=0.815, adj=0.143, (0 split)

Node number 22: 36 observations,    complexity param=0.0122449
  predicted class=Pavement  expected loss=0.5  P(node) =0.06883365
    class counts:    18    18
   probabilities: 0.500 0.500 
  left son=44 (12 obs) right son=45 (24 obs)
  Primary splits:
      danceability &lt; 0.4515   to the right, improve=2.250000, (0 missing)
      tempo        &lt; 127.3205 to the left,  improve=2.216749, (0 missing)
      liveness     &lt; 0.1185   to the right, improve=2.025000, (0 missing)
      valence      &lt; 0.6305   to the left,  improve=1.285714, (0 missing)
  Surrogate splits:
      tempo   &lt; 187.986  to the right, agree=0.722, adj=0.167, (0 split)
      valence &lt; 0.204    to the left,  agree=0.694, adj=0.083, (0 split)

Node number 23: 12 observations
  predicted class=Weezer    expected loss=0.08333333  P(node) =0.02294455
    class counts:     1    11
   probabilities: 0.083 0.917 

Node number 26: 9 observations
  predicted class=Pavement  expected loss=0.2222222  P(node) =0.01720841
    class counts:     7     2
   probabilities: 0.778 0.222 

Node number 27: 25 observations
  predicted class=Weezer    expected loss=0.28  P(node) =0.04780115
    class counts:     7    18
   probabilities: 0.280 0.720 

Node number 30: 14 observations
  predicted class=Pavement  expected loss=0.3571429  P(node) =0.02676864
    class counts:     9     5
   probabilities: 0.643 0.357 

Node number 31: 165 observations
  predicted class=Weezer    expected loss=0.2424242  P(node) =0.3154876
    class counts:    40   125
   probabilities: 0.242 0.758 

Node number 42: 14 observations
  predicted class=Pavement  expected loss=0.07142857  P(node) =0.02676864
    class counts:    13     1
   probabilities: 0.929 0.071 

Node number 43: 51 observations,    complexity param=0.01122449
  predicted class=Pavement  expected loss=0.4705882  P(node) =0.09751434
    class counts:    27    24
   probabilities: 0.529 0.471 
  left son=86 (7 obs) right son=87 (44 obs)
  Primary splits:
      tempo        &lt; 135.526  to the left,  improve=3.593583, (0 missing)
      liveness     &lt; 0.268    to the right, improve=2.440336, (0 missing)
      danceability &lt; 0.3595   to the right, improve=1.767320, (0 missing)
      valence      &lt; 0.4395   to the left,  improve=1.481532, (0 missing)
  Surrogate splits:
      valence      &lt; 0.10195  to the left,  agree=0.922, adj=0.429, (0 split)
      danceability &lt; 0.401    to the right, agree=0.902, adj=0.286, (0 split)

Node number 44: 12 observations
  predicted class=Pavement  expected loss=0.25  P(node) =0.02294455
    class counts:     9     3
   probabilities: 0.750 0.250 

Node number 45: 24 observations
  predicted class=Weezer    expected loss=0.375  P(node) =0.0458891
    class counts:     9    15
   probabilities: 0.375 0.625 

Node number 86: 7 observations
  predicted class=Pavement  expected loss=0  P(node) =0.01338432
    class counts:     7     0
   probabilities: 1.000 0.000 

Node number 87: 44 observations,    complexity param=0.01122449
  predicted class=Weezer    expected loss=0.4545455  P(node) =0.08413002
    class counts:    20    24
   probabilities: 0.455 0.545 
  left son=174 (33 obs) right son=175 (11 obs)
  Primary splits:
      tempo        &lt; 146.2065 to the right, improve=6.0606060, (0 missing)
      valence      &lt; 0.22     to the right, improve=1.6174100, (0 missing)
      liveness     &lt; 0.268    to the right, improve=0.9630094, (0 missing)
      danceability &lt; 0.2515   to the right, improve=0.6687565, (0 missing)
  Surrogate splits:
      danceability &lt; 0.3915   to the left,  agree=0.818, adj=0.273, (0 split)

Node number 174: 33 observations,    complexity param=0.01122449
  predicted class=Pavement  expected loss=0.3939394  P(node) =0.06309751
    class counts:    20    13
   probabilities: 0.606 0.394 
  left son=348 (26 obs) right son=349 (7 obs)
  Primary splits:
      valence      &lt; 0.4395   to the left,  improve=3.8125210, (0 missing)
      tempo        &lt; 156.6715 to the left,  improve=2.4729600, (0 missing)
      danceability &lt; 0.221    to the right, improve=1.8235100, (0 missing)
      liveness     &lt; 0.4165   to the left,  improve=0.5597736, (0 missing)

Node number 175: 11 observations
  predicted class=Weezer    expected loss=0  P(node) =0.0210325
    class counts:     0    11
   probabilities: 0.000 1.000 

Node number 348: 26 observations
  predicted class=Pavement  expected loss=0.2692308  P(node) =0.04971319
    class counts:    19     7
   probabilities: 0.731 0.269 

Node number 349: 7 observations
  predicted class=Weezer    expected loss=0.1428571  P(node) =0.01338432
    class counts:     1     6
   probabilities: 0.143 0.857 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot tree </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit, <span class="at">uniform=</span><span class="cn">TRUE</span>, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">main=</span><span class="st">"Regression Tree for Pavement/Weezer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="christmas-or-not" class="level2">
<h2 class="anchored" data-anchor-id="christmas-or-not">Christmas or Not?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>christmas <span class="ot">&lt;-</span> <span class="fu">get_playlist_audio_features</span>(<span class="st">""</span>, <span class="st">"5OP7itTh52BMfZS1DJrdlv"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>christmas<span class="sc">$</span>christmas <span class="ot">&lt;-</span> <span class="st">"yes"</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>not <span class="ot">&lt;-</span> <span class="fu">get_playlist_audio_features</span>(<span class="st">""</span>, <span class="st">"6i2Qd6OpeRBAzxfscNXeWp"</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>not<span class="sc">$</span>christmas <span class="ot">&lt;-</span> <span class="st">"no"</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>christmas_not <span class="ot">&lt;-</span><span class="fu">rbind</span>(christmas, not)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">as.factor</span>(christmas) <span class="sc">~</span> danceability <span class="sc">+</span> valence <span class="sc">+</span> tempo <span class="sc">+</span> liveness <span class="sc">+</span> tempo <span class="sc">+</span> mode, <span class="at">data=</span>christmas_not)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot tree </span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(fit, <span class="at">uniform=</span><span class="cn">TRUE</span>, </span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>   <span class="at">main=</span><span class="st">"Regression Tree for Christmas/Not"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week_6_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(not<span class="sc">$</span>mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1 
27 85 </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../class_notes/week_5.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Week 5: Practicing with Spotify</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2024, Daniel Shanahan</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>