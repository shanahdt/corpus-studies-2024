[
  {
    "objectID": "class_notes/week_4.html",
    "href": "class_notes/week_4.html",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "Let’s talk about key-finding algorithms.\nExplore where they might disagree, and try to figure out why.\nWhat would it look like to devise your own key-finding algorithm?\n\n\n\nWhen we hear this ringtone, it sounds as though it’s in C, but why?\n\n\n\nNokia\n\n\n\nIt doesn’t begin with C, it begins with G.\nC isn’t the most common note–in fact, it only occurs once before the final bar, and it’s on the “and” of 2 in the third measure (a pretty weak position metrically).\nIs a key just whatever key the piece ends in? If we ended this on A, would it sound like it’s in A minor? It would be the same key signature, and we’d actually have a nice cadential ascent to the final A from the G in the third measure.\n\nSo what gives? Why do we hear this as being in C?\nPerhaps a follow-up question might simply be: what makes us hear something as being in a key?\n\n\n\n\n\nThis approach used what we might call an exclusionary approach, eliminating different key possibilities as pitch classes were introduced over the course of a musical passage.\nFor example, with the Nokia theme, the opening G would fit into seven major keys (G, C, D, F, B-flats, A-flat, E-flat;); six of those keys would include the opening two notes; and three of those six would still be possible when presented with the first three notes. By the end of the first measure, however, the only major key that would encompass all four melody notes would be C major. If more than one key was still available however, the algorithm would place more weight on the pitches present at the start of the piece. This worked quite well on pieces that were overtly tonal, but it was less effective for pieces that contained non-diatonic pitches (which is most pieces!)\n\n\n\nLonguet-Higgins and Steedman's 1971 Key-Finding Algorithm\n\n\n\n\n\nAs you might guess, the Longuet-Higgins and Steedman would miss a lot of musical instances. For example, pieces that have non-harmonic chords would struggle, as would pieces that had a lot of chromatic ornamentations. Ideally an algorithm would allow for these pitches to occur, but acknowledge that pitches in the key might be a better fit than those outside of the key, and that certain pitches in the key should be more heavily weighted than others.\nCarol Krumhansl and Mark Schmuckler (Krumhansl, 1990) would devise an algorithm that tallied up the pitch classes of an excerpt and compared the distribution of these pitch classes to ratings from an earlier probe-tone experiment. (Krumhansl and Kessler, 1982). The weightings can be seen below.\nWe might think of this as a correlational approach. We tally up all of the pitches in a corpus, and then run a correlation on this key-profile. We run this over all of the keys, and the one that best fits is then labeled as “the key”.\n\nlibrary(spotifyr)\nlibrary(compmus)\nlibrary(tidyverse)\nlibrary(purrr)\n\n\nks_major_key &lt;-\n  c(6.35, \n   2.23, \n   3.48, \n   2.33, \n   4.38, \n   4.09, \n   2.52, \n   5.19, \n   2.39, \n   3.66, \n   2.29, \n   2.88)\n\nks_minor_key &lt;-\n  c(6.33, \n  2.68, \n  3.52, \n  5.38, \n  2.60, \n  3.53, \n  2.54, \n  4.75, \n  3.98, \n  2.69, \n  3.34, \n  3.17)\n\nAn interesting distinction here is that of experiment-derived vs. corpus-derived weightings. Should a key-finding algorithm intend to match how we hear key in a controlled lab environment (with basic harmonic progression stimuli), or should they use real music as a starting point? If they use real music, which music?\n\n\n\nHector Bellman created a key-finding algorithm that used Helen Budge’s dissertation from the 1940s as a starting point. Budge tallied up note occurrences in composers from the classical music canon, looking at the tonal makeup of a large collection of pieces. Bellman then used these frequencies as the starting point for his own key-finding algorithm.\n\nmajor &lt;- c(16.80, \n            0.86,\n            12.95,\n            1.41,\n            13.49,\n            11.93,\n            1.25,\n            20.28,\n            1.80,\n            8.04,\n            0.62,\n            10.57)\n\nminor &lt;- c(18.16,\n            0.69,\n            12.99,\n            13.34,\n            1.07,\n            11.15,\n            1.38,\n            21.07,\n            7.49,\n            1.53,\n            0.92,\n            10.21)\n\n\n\n\nDavid Temperley (2001) also employed Western classical music as a starting point for his early key-finding work (not to be confused with his more dynamic Bayesian-informed later work). He used examples from a commonly used music theory textbook (Stefan Kostka and Dorothy Payne’s Tonal Harmony).\n\nmajor &lt;- c(0.748, \n            0.060, \n            0.488,\n            0.082, \n            0.670, \n            0.460, \n            0.096, \n            0.715, \n            0.104, \n            0.366,\n            0.057, \n            0.400)\n\nminor &lt;- c(0.712, \n            0.084, \n            0.474, \n            0.618, \n            0.049, \n            0.460, \n            0.105, \n            0.747, \n            0.404, \n            0.067, \n            0.133, \n            0.330)\n\n\n\n\nBret Aarden (2003) argued that folk music would be a better fit than those generated from classical music. He used the Essen Folksong collection (consisting of thousands of folksongs throughout Europe, although with an uneven balance toward German folksong), to come up with the weightings below.\n\nmajor &lt;- c(17.7661, \n            0.145624, \n            14.9265, \n            0.160186, \n            19.8049, \n            11.3587, \n            0.291248, \n            22.062, \n            0.145624, \n            8.15494, \n            0.232998, \n            4.95122)\n            \nminor &lt;- c(18.2648, \n            0.737619, \n            14.0499, \n            16.8599, \n            0.702494, \n            14.4362, \n            0.702494, \n            18.6161, \n            4.56621, \n            1.93186, \n            7.37619, \n            1.75623)\n\n\n\n\nCraig Sapp argued that we probably didn’t even need to get frequencies from corpora or experiments. If we just assume that the tonic and the dominant (scale degrees 1 and 5) are the most important, and the other pitches in the key are less important, but more important than those not in the key, then we have a pretty simple weighting system (that works quite well!).\n\nmajor &lt;- c(2, 0, 1, 0, 1, 1, 0, 2, 0, 1, 0, 1)\n\nminor &lt;- c(2, 0, 1, 1, 0, 1, 0, 2, 1, 0, 0.5, 0.5)\n\n\n\n\nJosh Albrecht and I tried our hands at this problem, and picked a set of classical works from the Humdrum corpus, looking at only the first and last eight measures of each. The numbers are below.\n\nmajor &lt;- c(0.238, \n            0.006, \n            0.111, \n            0.006, \n            0.137, \n            0.094, \n            0.016, \n            0.214, \n            0.009, \n            0.080, \n            0.008, \n            0.081) \n\nminor &lt;- c(0.220, \n            0.006, \n            0.104, \n            0.123, \n            0.019, \n            0.103, \n            0.012, \n            0.214, \n            0.062, \n            0.022, \n            0.061, \n            0.052)\n\nWe also tried a Euclidean distance approach, rather than a correlational approach.\nWe tried to explain it as follows:\n\nIn a two-dimensional space, if there were 70% of pitch X and 30% pitch Y, the Cartesian location of the point representing this pitch-class distribution would be at X 1⁄4 0.7 and Y 1⁄4 0.3. In this case, we are examining the distribution of 12 pitch classes, resulting in a 12-dimensional Cartesian space. The pitch-class distribution of each piece is represented by a point in that 12-dimensional space. The distance is then measured between this point and the 24 points representing the 12 major and 12 minor key pitch-class distributions, and the key separated by the shortest distance is taken to be the key of the work.\n\nBelow is a table comparing how well this did to the others.\n\n\n\nComparing the Albrecht and Shanahan to others\n\n\n\n\n\nThey each perform a bit differently on different types of tasks.\n\n\n\nComparing key-finding algorithms in major, minor, and overall (from Albrecht and Shanahan, 2013)\n\n\n\n\n\n\nmusic21 has a number of built-in key-finding algorithms, and it’s nice to be able to compare keys in specific pieces. You can start to see the differences between them, and their respective biases.\nThis code will grab all of the files in a folder (here a number of Yugoslav folk songs):\n\nimport glob\n\n###change this path to be your own!\ndef filebrowser(ext=\"/Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/*.krn\"):\n    \"Returns files with an extension\"\n    return [f for f in glob.glob(ext)]\n\nfile_list = filebrowser()\n\nAnd here I will grab the key of each one and print it out using different algorithms:\n\nfrom music21 import *\nfor kern_file in file_list:\n\n  melody = converter.parse(kern_file)       \n  krum = analysis.discrete.KrumhanslKessler(melody)\n  krum_key = krum.getSolution(melody)\n  \n  aarden = analysis.discrete.AardenEssen(melody)\n  aarden_key = aarden.getSolution(melody)\n\n  bellman = analysis.discrete.BellmanBudge(melody)\n  bellman_key = bellman.getSolution(melody)\n\n  temperley = analysis.discrete.TemperleyKostkaPayne(melody)\n  temperley_key = temperley.getSolution(melody)\n\n  sapp = analysis.discrete.SimpleWeights(melody)\n  sapp_key = sapp.getSolution(melody)\n\nAnd then we can call all of our variables like so:\n\n  print(f'File name: {kern_file}\\nKrumhansl-Kessler: {krum_key}\\nAarden Essen: {aarden_key}\\nBellman-Budge: {bellman_key}\\nTemperley-Kostka-Payne: {temperley_key}\\nSapp Simple-Weightings: {sapp_key}\\n')\n\nThis returns the following results (with a very long list):\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos039.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos005.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: D major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos011.krn\nKrumhansl-Kessler: D major\nAarden Essen: D major\nBellman-Budge: D major\nTemperley-Kostka-Payne: D major\nSapp Simple-Weightings: D major\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos010.krn\nKrumhansl-Kessler: A- major\nAarden Essen: A- major\nBellman-Budge: A- major\nTemperley-Kostka-Payne: A- major\nSapp Simple-Weightings: C# major\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos004.krn\nKrumhansl-Kessler: F major\nAarden Essen: g minor\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: B- major\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos038.krn\nKrumhansl-Kessler: G major\nAarden Essen: e minor\nBellman-Budge: e minor\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos012.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: C major\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos006.krn\nKrumhansl-Kessler: C major\nAarden Essen: C major\nBellman-Budge: C major\nTemperley-Kostka-Payne: C major\nSapp Simple-Weightings: C major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos007.krn\nKrumhansl-Kessler: F major\nAarden Essen: B- major\nBellman-Budge: B- major\nTemperley-Kostka-Payne: B- major\nSapp Simple-Weightings: F major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos013.krn\nKrumhansl-Kessler: D major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos017.krn\nKrumhansl-Kessler: A- major\nAarden Essen: f minor\nBellman-Budge: f minor\nTemperley-Kostka-Payne: A- major\nSapp Simple-Weightings: A- major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos003.krn\nKrumhansl-Kessler: B major\nAarden Essen: E major\nBellman-Budge: E major\nTemperley-Kostka-Payne: E major\nSapp Simple-Weightings: B major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos002.krn\nKrumhansl-Kessler: F major\nAarden Essen: F major\nBellman-Budge: B- major\nTemperley-Kostka-Payne: B- major\nSapp Simple-Weightings: B- major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos016.krn\nKrumhansl-Kessler: D major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: D major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos014.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos028.krn\nKrumhansl-Kessler: a minor\nAarden Essen: g minor\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: d minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos029.krn\nKrumhansl-Kessler: C major\nAarden Essen: C major\nBellman-Budge: C major\nTemperley-Kostka-Payne: C major\nSapp Simple-Weightings: C major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos015.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos001.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos112.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos106.krn\nKrumhansl-Kessler: F major\nAarden Essen: F major\nBellman-Budge: B- major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: B- major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos066.krn\nKrumhansl-Kessler: g minor\nAarden Essen: g minor\nBellman-Budge: g minor\nTemperley-Kostka-Payne: g minor\nSapp Simple-Weightings: g minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos072.krn\nKrumhansl-Kessler: a minor\nAarden Essen: F major\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: F major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos099.krn\nKrumhansl-Kessler: G major\nAarden Essen: a minor\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos098.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos073.krn\nKrumhansl-Kessler: a minor\nAarden Essen: F major\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: d minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos067.krn\nKrumhansl-Kessler: D major\nAarden Essen: e minor\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\nThis code will give us the key, and the confidence of each key, with different algorithms:\n\nimport pandas as pd\nfrom music21 import *\nkrum_kess = []\naarden_essen = []\ntemperley_kp = []\nbellman_budge = []\nsapp_weighted = []\n\ntitles = []\nfor file in file_list:\n  titles.append(file.split(\"/\")[-1])\n  melody = converter.parse(file) \n \n  krum = analysis.discrete.KrumhanslKessler(melody)\n  krum_key = krum.getSolution(melody)\n  coef_krum = round(krum_key.correlationCoefficient, 3)\n  krum_kess.append(f'{krum_key} ({coef_krum})')\n\n  aarden = analysis.discrete.AardenEssen(melody)\n  coef_aarden = round(aarden_key.correlationCoefficient, 3)\n  aarden_key = aarden.getSolution(melody)\n  aarden_essen.append(f'{aarden_key} ({coef_aarden})')\n  \n  bellman = analysis.discrete.BellmanBudge(melody)\n  bellman_key = bellman.getSolution(melody)\n  coef_bellman = round(bellman_key.correlationCoefficient, 3)\n  bellman_budge.append(f'{bellman_key} ({coef_bellman})')\n\n  sapp = analysis.discrete.SimpleWeights(melody)\n  sapp_key = sapp.getSolution(melody)\n  coef_sapp = round(sapp_key.correlationCoefficient, 3)\n  sapp_weighted.append(f'{sapp_key} ({coef_sapp})')\n  \n  temperley = analysis.discrete.TemperleyKostkaPayne(melody)\n  temperley_key = temperley.getSolution(melody)\n  coef_temperley = round(temperley_key.correlationCoefficient, 3)\n  temperley_kp.append(f'{temperley_key} ({coef_temperley})')\n\npd.set_option('max_rows', 371)\ndf = pd.DataFrame(list(zip(titles, krum_kess, aarden_essen, bellman_budge, sapp_weighted, temperley_kp)), columns= ['Chorale','Krumhansl-Kessler', 'Aarden-Essen', 'Bellman-Budge', 'Sapp Weighted', 'Temperley-KP'])\ndf\n\nHere is a table of each key decided by each algorithm:\n\n\n\n\n\n\n\n\n\nChorale\n\n\nKrumhansl-Kessler\n\n\nAarden-Essen\n\n\nBellman-Budge\n\n\nSapp Weighted\n\n\nTemperley-KP\n\n\n\n\n\n\n0\n\n\njugos039.krn\n\n\nb minor (0.64)\n\n\nG major (0.848)\n\n\nG major (0.653)\n\n\ne minor (0.663)\n\n\nG major (0.693)\n\n\n\n\n1\n\n\njugos005.krn\n\n\nG major (0.765)\n\n\nG major (0.793)\n\n\nG major (0.79)\n\n\nD major (0.711)\n\n\nG major (0.827)\n\n\n\n\n2\n\n\njugos011.krn\n\n\nD major (0.839)\n\n\nD major (0.887)\n\n\nD major (0.757)\n\n\nD major (0.753)\n\n\nD major (0.839)\n\n\n\n\n3\n\n\njugos010.krn\n\n\nA- major (0.762)\n\n\nA- major (0.83)\n\n\nA- major (0.773)\n\n\nC# major (0.692)\n\n\nA- major (0.838)\n\n\n\n\n4\n\n\njugos004.krn\n\n\nF major (0.618)\n\n\ng minor (0.886)\n\n\nF major (0.727)\n\n\nB- major (0.686)\n\n\nF major (0.715)\n\n\n\n\n5\n\n\njugos038.krn\n\n\nG major (0.598)\n\n\ne minor (0.827)\n\n\ne minor (0.636)\n\n\nG major (0.587)\n\n\nG major (0.688)\n\n\n\n\n6\n\n\njugos012.krn\n\n\nG major (0.858)\n\n\nG major (0.727)\n\n\nG major (0.688)\n\n\nC major (0.716)\n\n\nG major (0.789)\n\n\n\n\n7\n\n\njugos006.krn\n\n\nC major (0.705)\n\n\nC major (0.753)\n\n\nC major (0.594)\n\n\nC major (0.582)\n\n\nC major (0.696)\n\n\n\n\n8\n\n\njugos007.krn\n\n\nF major (0.768)\n\n\nB- major (0.685)\n\n\nB- major (0.787)\n\n\nF major (0.801)\n\n\nB- major (0.82)\n\n\n\n\n9\n\n\njugos013.krn\n\n\nD major (0.822)\n\n\nG major (0.882)\n\n\nG major (0.859)\n\n\nG major (0.796)\n\n\nG major (0.826)\n\n\n\n\n10\n\n\njugos017.krn\n\n\nA- major (0.696)\n\n\nf minor (0.906)\n\n\nf minor (0.586)\n\n\nA- major (0.575)\n\n\nA- major (0.672)\n\n\n\n\n11\n\n\njugos003.krn\n\n\nB major (0.815)\n\n\nE major (0.683)\n\n\nE major (0.793)\n\n\nB major (0.817)\n\n\nE major (0.781)\n\n\n\n\n12\n\n\njugos002.krn\n\n\nF major (0.837)\n\n\nF major (0.858)\n\n\nB- major (0.828)\n\n\nB- major (0.884)\n\n\nB- major (0.806)\n\n\n\n\n13\n\n\njugos016.krn\n\n\nD major (0.829)\n\n\nG major (0.77)\n\n\nG major (0.843)\n\n\nD major (0.77)\n\n\nG major (0.851)\n\n\n\n\n14\n\n\njugos014.krn\n\n\nG major (0.797)\n\n\nG major (0.907)\n\n\nG major (0.784)\n\n\nG major (0.708)\n\n\nG major (0.857)\n\n\n\n\n15\n\n\njugos028.krn\n\n\na minor (0.547)\n\n\ng minor (0.902)\n\n\nF major (0.667)\n\n\nd minor (0.547)\n\n\nF major (0.659)\n\n\n\n\n16\n\n\njugos029.krn\n\n\nC major (0.64)\n\n\nC major (0.787)\n\n\nC major (0.616)\n\n\nC major (0.577)\n\n\nC major (0.682)\n\n\n\n\n17\n\n\njugos015.krn\n\n\nG major (0.744)\n\n\nG major (0.675)\n\n\nG major (0.611)\n\n\nG major (0.616)\n\n\nG major (0.709)\n\n\n\n\n18\n\n\njugos001.krn\n\n\nb minor (0.733)\n\n\nG major (0.688)\n\n\nG major (0.703)\n\n\ne minor (0.725)\n\n\nG major (0.809)\n\n\n\n\n19\n\n\njugos112.krn\n\n\nb minor (0.66)\n\n\nG major (0.84)\n\n\nG major (0.511)\n\n\ne minor (0.617)\n\n\nG major (0.576)\n\n\n\n\n20\n\n\njugos106.krn\n\n\nF major (0.872)\n\n\nF major (0.649)\n\n\nB- major (0.777)\n\n\nB- major (0.843)\n\n\nF major (0.795)\n\n\n\n\n21\n\n\njugos066.krn\n\n\ng minor (0.771)\n\n\ng minor (0.763)\n\n\ng minor (0.745)\n\n\ng minor (0.713)\n\n\ng minor (0.734)\n\n\n\n\n22\n\n\njugos072.krn\n\n\na minor (0.818)\n\n\nF major (0.734)\n\n\nF major (0.702)\n\n\nF major (0.566)\n\n\nF major (0.692)\n\n\n\n\n23\n\n\njugos099.krn\n\n\nG major (0.662)\n\n\na minor (0.773)\n\n\nG major (0.767)\n\n\nG major (0.719)\n\n\nG major (0.752)\n\n\n\n\n24\n\n\njugos098.krn\n\n\nb minor (0.697)\n\n\nG major (0.847)\n\n\nG major (0.499)\n\n\ne minor (0.568)\n\n\nG major (0.568)\n\n\n\n\n25\n\n\njugos073.krn\n\n\na minor (0.677)\n\n\nF major (0.642)\n\n\nF major (0.619)\n\n\nd minor (0.578)\n\n\nF major (0.648)\n\n\n\n\n26\n\n\njugos067.krn\n\n\nD major (0.619)\n\n\ne minor (0.746)\n\n\nG major (0.663)\n\n\nG major (0.628)\n\n\nG major (0.694)\n\n\n\n\n27\n\n\njugos107.krn\n\n\nG major (0.696)\n\n\nG major (0.718)\n\n\nG major (0.82)\n\n\nG major (0.708)\n\n\nG major (0.833)\n\n\n\n\n28\n\n\njugos113.krn\n\n\nG major (0.788)\n\n\nG major (0.932)\n\n\nG major (0.662)\n\n\nC major (0.699)\n\n\nG major (0.737)\n\n\n\n\n29\n\n\njugos105.krn\n\n\nG major (0.782)\n\n\nG major (0.678)\n\n\nG major (0.854)\n\n\nG major (0.745)\n\n\nG major (0.866)\n\n\n\n\n30\n\n\njugos111.krn\n\n\nG major (0.765)\n\n\nG major (0.943)\n\n\nG major (0.684)\n\n\nC major (0.719)\n\n\nG major (0.75)\n\n\n\n\n31\n\n\njugos059.krn\n\n\nF major (0.81)\n\n\nF major (0.723)\n\n\nF major (0.823)\n\n\nF major (0.729)\n\n\nF major (0.877)\n\n\n\n\n32\n\n\njugos071.krn\n\n\nF major (0.771)\n\n\nF major (0.929)\n\n\nF major (0.888)\n\n\nF major (0.82)\n\n\nF major (0.832)\n\n\n\n\n33\n\n\njugos065.krn\n\n\nF major (0.627)\n\n\nF major (0.908)\n\n\nF major (0.577)\n\n\nB- major (0.631)\n\n\nF major (0.662)\n\n\n\n\n34\n\n\njugos064.krn\n\n\ng minor (0.797)\n\n\ng minor (0.668)\n\n\ng minor (0.836)\n\n\ng minor (0.775)\n\n\ng minor (0.822)\n\n\n\n\n35\n\n\njugos070.krn\n\n\nF major (0.84)\n\n\nF major (0.824)\n\n\nF major (0.832)\n\n\nF major (0.822)\n\n\nF major (0.867)\n\n\n\n\n36\n\n\njugos058.krn\n\n\nF major (0.819)\n\n\nF major (0.901)\n\n\nF major (0.777)\n\n\nF major (0.709)\n\n\nF major (0.856)\n\n\n\n\n37\n\n\njugos110.krn\n\n\nC major (0.756)\n\n\nC major (0.89)\n\n\nC major (0.713)\n\n\nC major (0.791)\n\n\nC major (0.735)\n\n\n\n\n38\n\n\njugos104.krn\n\n\nG major (0.641)\n\n\ne minor (0.597)\n\n\ng minor (0.492)\n\n\nG major (0.568)\n\n\nG major (0.509)\n\n\n\n\n39\n\n\njugos100.krn\n\n\ng minor (0.691)\n\n\nC major (0.476)\n\n\nC major (0.626)\n\n\nc minor (0.652)\n\n\nc minor (0.558)\n\n\n\n\n40\n\n\njugos114.krn\n\n\nC major (0.861)\n\n\nF major (0.576)\n\n\nF major (0.798)\n\n\nC major (0.804)\n\n\nF major (0.741)\n\n\n\n\n41\n\n\njugos074.krn\n\n\nG major (0.636)\n\n\nG major (0.78)\n\n\nG major (0.647)\n\n\nG major (0.651)\n\n\nG major (0.651)\n\n\n\n\n42\n\n\njugos060.krn\n\n\ng minor (0.627)\n\n\nd minor (0.573)\n\n\nF major (0.621)\n\n\nB- major (0.586)\n\n\nF major (0.664)\n\n\n\n\n43\n\n\njugos048.krn\n\n\nF major (0.696)\n\n\nF major (0.687)\n\n\nF major (0.647)\n\n\nF major (0.589)\n\n\nF major (0.737)\n\n\n\n\n44\n\n\njugos049.krn\n\n\nA major (0.821)\n\n\nA major (0.754)\n\n\nA major (0.707)\n\n\nA major (0.74)\n\n\nA major (0.738)\n\n\n\n\n45\n\n\njugos061.krn\n\n\nC major (0.684)\n\n\nC major (0.716)\n\n\nF major (0.579)\n\n\nF major (0.68)\n\n\nC major (0.625)\n\n\n\n\n46\n\n\njugos075.krn\n\n\nG major (0.896)\n\n\nG major (0.54)\n\n\nG major (0.814)\n\n\nG major (0.837)\n\n\nG major (0.829)\n\n\n\n\n47\n\n\njugos115.krn\n\n\nG major (0.898)\n\n\nG major (0.835)\n\n\nG major (0.947)\n\n\nG major (0.939)\n\n\nG major (0.948)\n\n\n\n\n48\n\n\njugos101.krn\n\n\nG major (0.819)\n\n\nG major (0.958)\n\n\nG major (0.777)\n\n\nG major (0.709)\n\n\nG major (0.856)\n\n\n\n\n49\n\n\njugos117.krn\n\n\nC major (0.85)\n\n\nC major (0.89)\n\n\nC major (0.784)\n\n\na minor (0.765)\n\n\nC major (0.893)\n\n\n\n\n50\n\n\njugos103.krn\n\n\nG major (0.676)\n\n\nG major (0.862)\n\n\nG major (0.688)\n\n\nD major (0.62)\n\n\nG major (0.737)\n\n\n\n\n51\n\n\njugos063.krn\n\n\nF major (0.572)\n\n\nd minor (0.775)\n\n\nF major (0.561)\n\n\nB- major (0.524)\n\n\nF major (0.635)\n\n\n\n\n52\n\n\njugos077.krn\n\n\na minor (0.622)\n\n\na minor (0.648)\n\n\nG major (0.64)\n\n\nd minor (0.533)\n\n\na minor (0.581)\n\n\n\n\n53\n\n\njugos088.krn\n\n\na minor (0.622)\n\n\nD major (0.689)\n\n\nD major (0.545)\n\n\nD major (0.564)\n\n\nA major (0.439)\n\n\n\n\n54\n\n\njugos089.krn\n\n\na minor (0.594)\n\n\nG major (0.506)\n\n\nG major (0.544)\n\n\nC major (0.583)\n\n\nG major (0.619)\n\n\n\n\n55\n\n\njugos076.krn\n\n\nC major (0.828)\n\n\nC major (0.659)\n\n\nC major (0.733)\n\n\nC major (0.725)\n\n\nC major (0.809)\n\n\n\n\n56\n\n\njugos062.krn\n\n\nG major (0.603)\n\n\ne minor (0.812)\n\n\nG major (0.594)\n\n\nC major (0.597)\n\n\nG major (0.622)\n\n\n\n\n57\n\n\njugos102.krn\n\n\na minor (0.495)\n\n\nG major (0.57)\n\n\ne minor (0.577)\n\n\ne minor (0.54)\n\n\nG major (0.602)\n\n\n\n\n58\n\n\njugos116.krn\n\n\nG major (0.676)\n\n\nG major (0.651)\n\n\nG major (0.749)\n\n\ne minor (0.666)\n\n\nG major (0.774)\n\n\n\n\n59\n\n\njugos047.krn\n\n\nG major (0.835)\n\n\nC major (0.834)\n\n\nC major (0.861)\n\n\nC major (0.834)\n\n\nC major (0.861)\n\n\n\n\n60\n\n\njugos053.krn\n\n\nG major (0.903)\n\n\nG major (0.904)\n\n\nG major (0.786)\n\n\nG major (0.777)\n\n\nG major (0.859)\n\n\n\n\n61\n\n\njugos084.krn\n\n\nD major (0.65)\n\n\ne minor (0.859)\n\n\nG major (0.685)\n\n\nD major (0.665)\n\n\nG major (0.708)\n\n\n\n\n62\n\n\njugos090.krn\n\n\na minor (0.925)\n\n\na minor (0.695)\n\n\na minor (0.79)\n\n\na minor (0.774)\n\n\na minor (0.838)\n\n\n\n\n63\n\n\njugos091.krn\n\n\nE- major (0.711)\n\n\nE- major (0.868)\n\n\nE- major (0.666)\n\n\nE- major (0.632)\n\n\nE- major (0.726)\n\n\n\n\n64\n\n\njugos085.krn\n\n\nG major (0.639)\n\n\nG major (0.739)\n\n\nG major (0.772)\n\n\nG major (0.665)\n\n\nG major (0.805)\n\n\n\n\n65\n\n\njugos052.krn\n\n\nG major (0.769)\n\n\nG major (0.791)\n\n\nG major (0.701)\n\n\ne minor (0.708)\n\n\nG major (0.816)\n\n\n\n\n66\n\n\njugos046.krn\n\n\nG major (0.872)\n\n\nG major (0.839)\n\n\nG major (0.769)\n\n\nG major (0.772)\n\n\nG major (0.835)\n\n\n\n\n67\n\n\njugos118.krn\n\n\nb minor (0.878)\n\n\nG major (0.831)\n\n\nG major (0.801)\n\n\nG major (0.725)\n\n\nG major (0.86)\n\n\n\n\n68\n\n\njugos078.krn\n\n\ng minor (0.705)\n\n\ng minor (0.907)\n\n\nF major (0.565)\n\n\nB- major (0.567)\n\n\ng minor (0.607)\n\n\n\n\n69\n\n\njugos050.krn\n\n\nC major (0.82)\n\n\nF major (0.721)\n\n\nF major (0.951)\n\n\nF major (0.877)\n\n\nF major (0.894)\n\n\n\n\n70\n\n\njugos044.krn\n\n\nG major (0.853)\n\n\nG major (0.93)\n\n\nG major (0.86)\n\n\nG major (0.825)\n\n\nG major (0.865)\n\n\n\n\n71\n\n\njugos093.krn\n\n\nG major (0.729)\n\n\nG major (0.889)\n\n\nG major (0.657)\n\n\nG major (0.644)\n\n\nG major (0.712)\n\n\n\n\n72\n\n\njugos087.krn\n\n\na minor (0.585)\n\n\nG major (0.709)\n\n\nG major (0.55)\n\n\nC major (0.587)\n\n\nG major (0.611)\n\n\n\n\n73\n\n\njugos086.krn\n\n\nb- minor (0.794)\n\n\nb- minor (0.632)\n\n\nb- minor (0.505)\n\n\nb- minor (0.583)\n\n\nb- minor (0.554)\n\n\n\n\n74\n\n\njugos092.krn\n\n\nG major (0.621)\n\n\nG major (0.6)\n\n\nG major (0.686)\n\n\nD major (0.647)\n\n\nG major (0.727)\n\n\n\n\n75\n\n\njugos045.krn\n\n\nG major (0.546)\n\n\ne minor (0.791)\n\n\ne minor (0.652)\n\n\ne minor (0.56)\n\n\ne minor (0.687)\n\n\n\n\n76\n\n\njugos051.krn\n\n\ne minor (0.565)\n\n\nb minor (0.74)\n\n\nD major (0.566)\n\n\nG major (0.579)\n\n\nD major (0.589)\n\n\n\n\n77\n\n\njugos079.krn\n\n\nG major (0.837)\n\n\nG major (0.555)\n\n\nG major (0.903)\n\n\nG major (0.832)\n\n\nG major (0.924)\n\n\n\n\n78\n\n\njugos119.krn\n\n\nG major (0.778)\n\n\nG major (0.933)\n\n\nG major (0.778)\n\n\nG major (0.71)\n\n\nG major (0.858)\n\n\n\n\n79\n\n\njugos109.krn\n\n\nG major (0.637)\n\n\nG major (0.883)\n\n\nG major (0.668)\n\n\nG major (0.583)\n\n\nG major (0.748)\n\n\n\n\n80\n\n\njugos055.krn\n\n\nG major (0.868)\n\n\nG major (0.756)\n\n\nG major (0.816)\n\n\nG major (0.842)\n\n\nG major (0.796)\n\n\n\n\n81\n\n\njugos041.krn\n\n\nG major (0.482)\n\n\ne minor (0.814)\n\n\nG major (0.55)\n\n\nG major (0.547)\n\n\nG major (0.546)\n\n\n\n\n82\n\n\njugos069.krn\n\n\na minor (0.686)\n\n\nG major (0.532)\n\n\nG major (0.719)\n\n\nC major (0.607)\n\n\nG major (0.716)\n\n\n\n\n83\n\n\njugos096.krn\n\n\nG major (0.825)\n\n\nG major (0.805)\n\n\nG major (0.869)\n\n\nG major (0.815)\n\n\nG major (0.865)\n\n\n\n\n84\n\n\njugos082.krn\n\n\nG major (0.705)\n\n\nG major (0.904)\n\n\nG major (0.733)\n\n\nC major (0.609)\n\n\nG major (0.806)\n\n\n\n\n85\n\n\njugos083.krn\n\n\nD major (0.855)\n\n\nG major (0.864)\n\n\nG major (0.864)\n\n\nD major (0.8)\n\n\nG major (0.813)\n\n\n\n\n86\n\n\njugos097.krn\n\n\nG major (0.617)\n\n\nG major (0.885)\n\n\nG major (0.637)\n\n\nD major (0.631)\n\n\nG major (0.638)\n\n\n\n\n87\n\n\njugos068.krn\n\n\nG major (0.829)\n\n\nC major (0.666)\n\n\nC major (0.843)\n\n\nC major (0.77)\n\n\nC major (0.851)\n\n\n\n\n88\n\n\njugos040.krn\n\n\nb minor (0.753)\n\n\nG major (0.907)\n\n\nG major (0.68)\n\n\nD major (0.606)\n\n\nG major (0.673)\n\n\n\n\n89\n\n\njugos054.krn\n\n\nG major (0.838)\n\n\nG major (0.791)\n\n\nG major (0.824)\n\n\nG major (0.765)\n\n\nG major (0.869)\n\n\n\n\n90\n\n\njugos108.krn\n\n\na minor (0.504)\n\n\nd minor (0.905)\n\n\nd minor (0.585)\n\n\nd minor (0.553)\n\n\nd minor (0.566)\n\n\n\n\n91\n\n\njugos042.krn\n\n\nG major (0.66)\n\n\nG major (0.597)\n\n\nG major (0.628)\n\n\nC major (0.622)\n\n\nG major (0.733)\n\n\n\n\n92\n\n\njugos056.krn\n\n\nG major (0.874)\n\n\nG major (0.758)\n\n\nG major (0.854)\n\n\nG major (0.816)\n\n\nG major (0.874)\n\n\n\n\n93\n\n\njugos081.krn\n\n\nG major (0.79)\n\n\nG major (0.916)\n\n\nG major (0.762)\n\n\nG major (0.682)\n\n\nG major (0.848)\n\n\n\n\n94\n\n\njugos095.krn\n\n\nG major (0.792)\n\n\nG major (0.886)\n\n\nG major (0.771)\n\n\nG major (0.728)\n\n\nG major (0.836)\n\n\n\n\n95\n\n\njugos094.krn\n\n\ng minor (0.771)\n\n\ng minor (0.796)\n\n\ng minor (0.745)\n\n\ng minor (0.713)\n\n\ng minor (0.734)\n\n\n\n\n96\n\n\njugos080.krn\n\n\nG major (0.891)\n\n\nG major (0.734)\n\n\nC major (0.692)\n\n\nG major (0.738)\n\n\nG major (0.798)\n\n\n\n\n97\n\n\njugos057.krn\n\n\nF major (0.861)\n\n\nF major (0.754)\n\n\nF major (0.836)\n\n\nF major (0.776)\n\n\nF major (0.89)\n\n\n\n\n98\n\n\njugos043.krn\n\n\nb minor (0.735)\n\n\nG major (0.932)\n\n\nG major (0.823)\n\n\nD major (0.732)\n\n\nG major (0.855)\n\n\n\n\n99\n\n\njugos018.krn\n\n\nb- minor (0.807)\n\n\nb- minor (0.934)\n\n\nb- minor (0.551)\n\n\nb- minor (0.588)\n\n\nb- minor (0.587)\n\n\n\n\n100\n\n\njugos024.krn\n\n\nG major (0.824)\n\n\nG major (0.578)\n\n\nG major (0.873)\n\n\nG major (0.808)\n\n\nG major (0.895)\n\n\n\n\n101\n\n\njugos030.krn\n\n\nG major (0.793)\n\n\nG major (0.968)\n\n\nG major (0.837)\n\n\nG major (0.85)\n\n\nG major (0.848)\n\n\n\n\n102\n\n\njugos031.krn\n\n\nC major (0.797)\n\n\nF major (0.732)\n\n\nF major (0.823)\n\n\nC major (0.776)\n\n\nF major (0.804)\n\n\n\n\n103\n\n\njugos025.krn\n\n\nC major (0.908)\n\n\nC major (0.89)\n\n\nC major (0.831)\n\n\nC major (0.811)\n\n\nC major (0.894)\n\n\n\n\n104\n\n\njugos019.krn\n\n\na minor (0.611)\n\n\nf# minor (0.879)\n\n\na minor (0.53)\n\n\na minor (0.544)\n\n\na minor (0.504)\n\n\n\n\n105\n\n\njugos033.krn\n\n\nD major (0.664)\n\n\nG major (0.488)\n\n\nG major (0.667)\n\n\nG major (0.635)\n\n\nG major (0.602)\n\n\n\n\n106\n\n\njugos027.krn\n\n\ng minor (0.686)\n\n\nF major (0.685)\n\n\nF major (0.51)\n\n\nB- major (0.543)\n\n\nF major (0.549)\n\n\n\n\n107\n\n\njugos026.krn\n\n\nG major (0.895)\n\n\nG major (0.592)\n\n\nG major (0.805)\n\n\nG major (0.791)\n\n\nG major (0.87)\n\n\n\n\n108\n\n\njugos032.krn\n\n\nG major (0.936)\n\n\nG major (0.836)\n\n\nG major (0.878)\n\n\nG major (0.942)\n\n\nG major (0.913)\n\n\n\n\n109\n\n\njugos036.krn\n\n\nb minor (0.715)\n\n\nG major (0.853)\n\n\nG major (0.81)\n\n\nG major (0.726)\n\n\nG major (0.787)\n\n\n\n\n110\n\n\njugos022.krn\n\n\nD major (0.768)\n\n\nD major (0.88)\n\n\nD major (0.819)\n\n\nG major (0.781)\n\n\nD major (0.826)\n\n\n\n\n111\n\n\njugos023.krn\n\n\nC major (0.601)\n\n\nF major (0.883)\n\n\nF major (0.704)\n\n\nC major (0.639)\n\n\nF major (0.714)\n\n\n\n\n112\n\n\njugos037.krn\n\n\nG major (0.767)\n\n\nG major (0.822)\n\n\nG major (0.774)\n\n\nG major (0.724)\n\n\nG major (0.798)\n\n\n\n\n113\n\n\njugos021.krn\n\n\nD major (0.688)\n\n\ne minor (0.806)\n\n\nD major (0.739)\n\n\nG major (0.731)\n\n\nG major (0.762)\n\n\n\n\n114\n\n\njugos035.krn\n\n\nG major (0.881)\n\n\nG major (0.869)\n\n\nG major (0.952)\n\n\nG major (0.951)\n\n\nG major (0.938)\n\n\n\n\n115\n\n\njugos009.krn\n\n\nC major (0.762)\n\n\na minor (0.927)\n\n\nC major (0.752)\n\n\nC major (0.746)\n\n\nC major (0.814)\n\n\n\n\n116\n\n\njugos008.krn\n\n\nG major (0.896)\n\n\nG major (0.77)\n\n\nG major (0.806)\n\n\nG major (0.806)\n\n\nG major (0.872)\n\n\n\n\n117\n\n\njugos034.krn\n\n\nG major (0.897)\n\n\nG major (0.851)\n\n\nG major (0.779)\n\n\nG major (0.756)\n\n\nG major (0.866)\n\n\n\n\n118\n\n\njugos020.krn\n\n\nG major (0.888)\n\n\nG major (0.861)\n\n\nG major (0.86)\n\n\nG major (0.892)\n\n\nG major (0.897)\n\n\n\n\n\n\n\n\nHere, we can see the various windows of keys in a song:\n\nfor kern_file in file_list:\n  krum = analysis.discrete.KrumhanslKessler(kern_file)\n  krum_key = krum.getSolution(kern_file)\n  krum_key.correlationCoefficient\n  p = graph.plot.WindowedKey(kern_file.parts[0])\n  p.run()\n\nOne of these would look like this:\n\n\n\nWindowed analysis using the K-S algorithm\n\n\n\n\n\n\nIt might be worth having a look at some audio data now. For this, we will use the Spotify API and Ashley Burgoyne’s compmus package, and the spotifyr toolkit.\n\n\nIn order to explore the Spotify API, you will need a client ID and a client “secret”. You can find those here.\n\n\ncorrplot 0.92 loaded\n\n\n\ncircshift &lt;- function(v, n) {\n  if (n == 0) v else c(tail(v, n), head(v, -n))\n}\n# \n# # ### uses the Krumhansl Schmuckler Profiles\nmajor_key &lt;- c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)\nminor_key &lt;- c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)\n\n##sapp's simple weightings\n# major_key &lt;- c(2, 0, 1, 0, 1, 1, 0, 2, 0, 1, 0, 1)\n# \n# minor_key &lt;- c(2, 0, 1, 1, 0, 1, 0, 2, 1, 0, 0.5, 0.5)\n\nkey_templates &lt;-\n  tribble(\n    ~name, ~template,\n    \"Gb:maj\", circshift(major_key, 6),\n    \"Bb:min\", circshift(minor_key, 10),\n    \"Db:maj\", circshift(major_key, 1),\n    \"F:min\", circshift(minor_key, 5),\n    \"Ab:maj\", circshift(major_key, 8),\n    \"C:min\", circshift(minor_key, 0),\n    \"Eb:maj\", circshift(major_key, 3),\n    \"G:min\", circshift(minor_key, 7),\n    \"Bb:maj\", circshift(major_key, 10),\n    \"D:min\", circshift(minor_key, 2),\n    \"F:maj\", circshift(major_key, 5),\n    \"A:min\", circshift(minor_key, 9),\n    \"C:maj\", circshift(major_key, 0),\n    \"E:min\", circshift(minor_key, 4),\n    \"G:maj\", circshift(major_key, 7),\n    \"B:min\", circshift(minor_key, 11),\n    \"D:maj\", circshift(major_key, 2),\n    \"F#:min\", circshift(minor_key, 6),\n    \"A:maj\", circshift(major_key, 9),\n    \"C#:min\", circshift(minor_key, 1),\n    \"E:maj\", circshift(major_key, 4),\n    \"G#:min\", circshift(minor_key, 8),\n    \"B:maj\", circshift(major_key, 11),\n    \"D#:min\", circshift(minor_key, 3)\n  )\n\nLet’s look at Lucy Dacus’s “Night Shift”.\nThis grabs the track and does all the magic:\n\nnight_shift &lt;-\n  get_tidy_audio_analysis(\"1yYlpGuBiRRf33e1gY61bN\") |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  )\n\nAnd this is just a plotting function:\n\nnight_shift |&gt; \n  compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"euclidean\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n  ) |&gt;\n  ggplot(\n    aes(x = start + duration / 2, width = duration, y = name, fill = d)\n  ) +\n  geom_tile() +\n  scale_fill_viridis_c(guide = \"none\") +\n  theme_minimal() +\n  labs(x = \"Time (s)\", y = \"\")\n\n\n\n\n\nnight_shift &lt;-\n  get_tidy_audio_analysis(\"1yYlpGuBiRRf33e1gY61bN\") |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  )\n\nLet’s do some exercises:\n\nVisualize a song with all of these weightings.\n\nHow do the algorithms differ?\n\nCan you write a function that would call each weighting as an argument? What would that look like?\n\n\n\n\n\nThere are many different ways of calculating key, and what constitutes “tonality” can change quite a bit depending on how you approach it. If using a set of pitches from a corpus to define a key-profile, the question becomes “which corpus?”\nToday, we are going to look at what it means to generate a key-profile for more appropriate key-finding algorithms. We are going to break the class into a few separate sections:\n\nLooking at getting a broad key-profile from a playlist.\nBreaking that into a major and minor key-profile (and discussing the issues and implications with this)\nWorking on an in-class exercise that generates a key-profile from a corpus and then looks at\n\n\n\n\nThe basic code for getting a key-profile from a playlist is below. The process is as follows:\n\nGet the audio features from a playlist, and add the audio analysis onto the datafame.\nWe then create a “segments” column by using a map function from the tidyverse. Map functions basically apply a function over each element in a list. Here, we are saying “apply the compmus_c_transpose function to the key and segments lists from the add_audio_analysis function.”\n\nWhat does the compmus_c_transpose function do? It takes all of the chroma vectors and transposes them to the key of C, so that we can construct a single set of weightings from pieces in different keys.\n\nWe then only grab this transposed segments column and turn it into a more readable list with the unnest function.\n\nWe then grab the start, duration, and pitches info.\n\nWe then create a “pitches” column, and normalize these raw pitch counts. There are a few ways to do this, and there are different options for this.\nWe then used the compmus_gather_chroma function to take all of those chroma vectors and turn them into a list.\nWe then use the group_by and summarise functions from tidyverse, and get the mean count of each pitch class in the distribution.\n\n\n### grabs the key-profile of the indie-pop playlist.\nindie_pop_key_profile &lt;- get_playlist_audio_features(\"\", \"37i9dQZF1DWWEcRhUVtL8n\") |&gt;\n  add_audio_analysis() |&gt;\n  ## transpose all the chroma vectors to C.\n  mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n  ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n  select(segments) |&gt;\n  unnest(segments) |&gt; \n  select(start, duration, pitches) |&gt; \n  mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n  compmus_gather_chroma() |&gt;\n  group_by(pitch_class) |&gt;\n  summarise(mean_value = mean(value)) \n\nindie_pop_key_profile\n\nIdeally, we’d be able to turn this into a more reusable function. Below we’ve just turned made the playlist URI an argument:\n\nget_key_profile_broad &lt;- function(uri){\n   get_playlist_audio_features(\"\", uri) |&gt;\n   add_audio_analysis() |&gt;\n   ## transpose all the chroma vectors to C. (have I mentioned how great Burgoyne's library is??)\n   mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n   ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n   select(segments) |&gt;\n   unnest(segments) |&gt; \n   select(start, duration, pitches) |&gt; \n   mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n   compmus_gather_chroma() |&gt;\n   group_by(pitch_class) |&gt;\n   summarise(mean_value = median(value)) \n}\n\nAnd now we can just run the function like so:\n\nindie_pop &lt;- get_key_profile_broad(\"37i9dQZF1DWWEcRhUVtL8n\")\nindie_pop\n\nand we can plot it in a pretty straightforward way:\n\nbarplot(indie_pop$mean_value)\n\nSo we can look at other genres pretty easily. Here is me looking at Spotify’s “EDM 2023” playlist:\n\n\n\n\nedm &lt;- get_key_profile_broad(\"37i9dQZF1DX1kCIzMYtzum\")\nedm\n\n# A tibble: 12 × 2\n   pitch_class mean_value\n   &lt;fct&gt;            &lt;dbl&gt;\n 1 C                0.250\n 2 C#|Db            0.142\n 3 D                0.182\n 4 D#|Eb            0.169\n 5 E                0.157\n 6 F                0.165\n 7 F#|Gb            0.145\n 8 G                0.228\n 9 G#|Ab            0.148\n10 A                0.154\n11 A#|Bb            0.152\n12 B                0.167\n\n\nand once again we can plot it:\n\nbarplot(edm$mean_value)\n\n\n\n\n\n\n\nFor both of these distributions, we see a strong showing for scale degrees 1 and 5 (they aren’t really labeled in these quickie plots, but it would be the first and seventh column, respectively).\nWith the “Indie Pop” plot, we see a strong showing of scale degrees 1 and 5, and are followed by the diatonic pitches, but with the “EDM” list, scale degrees 2, flat 3, and 3 occur with pretty much the same frequency. It might be worth splitting the major and minor pieces up a bit?\n\n\n\n\n\nWe could break this into a few parts for our own comfort. Let’s start by just creating a function that grabs the data. As that’s the one that’s quite time intensive, and calls to the API, let’s try to run it only once.\n\ngrab_playlist_info &lt;- function(uri){\n   get_playlist_audio_features(\"\", uri) |&gt;\n   add_audio_analysis() \n}\n\nOnce we have that in place, we can create a variable, and then subset it from there. Here, I’m saving the full list, and then creating a major and a minor variable.\n\nplaylist &lt;- grab_playlist_info(\"37i9dQZF1DX1kCIzMYtzum\")  \nminor &lt;- playlist |&gt; filter(mode == 0)\nmajor &lt;- playlist |&gt; filter(mode == 1)\n\n\nget_pitch_list &lt;- function(input){\n   input |&gt;     \n   mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n   ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n   select(segments) |&gt;\n   unnest(segments) |&gt; \n   select(start, duration, pitches) |&gt; \n   mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n   compmus_gather_chroma() |&gt;\n   group_by(pitch_class) |&gt;\n   summarise(mean_value = mean(value))\n}\n\nAnd now we can get separate pitch lists for major and minor:\n\nminor_key &lt;- get_pitch_list(minor)\nmajor_key &lt;- get_pitch_list(major)\n\nand then of course we can use these to inform our own key mapping.\nWe can start by putting this all into a super quick but inefficient function like this (hoping to improve it as we go along):\n\nkey_plotter &lt;- function(uri, major, minor){\n   major_key &lt;- major\n   minor_key &lt;- minor\n   key_templates &lt;-\n   tribble(\n      ~name, ~template,\n      \"Gb:maj\", circshift(major_key, 6),\n      \"Bb:min\", circshift(minor_key, 10),\n      \"Db:maj\", circshift(major_key, 1),\n      \"F:min\", circshift(minor_key, 5),\n      \"Ab:maj\", circshift(major_key, 8),\n      \"C:min\", circshift(minor_key, 0),\n      \"Eb:maj\", circshift(major_key, 3),\n      \"G:min\", circshift(minor_key, 7),\n      \"Bb:maj\", circshift(major_key, 10),\n      \"D:min\", circshift(minor_key, 2),\n      \"F:maj\", circshift(major_key, 5),\n      \"A:min\", circshift(minor_key, 9),\n      \"C:maj\", circshift(major_key, 0),\n      \"E:min\", circshift(minor_key, 4),\n      \"G:maj\", circshift(major_key, 7),\n      \"B:min\", circshift(minor_key, 11),\n      \"D:maj\", circshift(major_key, 2),\n      \"F#:min\", circshift(minor_key, 6),\n      \"A:maj\", circshift(major_key, 9),\n      \"C#:min\", circshift(minor_key, 1),\n      \"E:maj\", circshift(major_key, 4),\n      \"G#:min\", circshift(minor_key, 8),\n      \"B:maj\", circshift(major_key, 11),\n      \"D#:min\", circshift(minor_key, 3)\n  )\n\ntune &lt;-\n  get_tidy_audio_analysis(uri) |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  ) \n\ntune |&gt; compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"euclidean\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n  ) |&gt; \n  ggplot(\n    aes(x = start + duration / 2, width = duration, y = name, fill = d)\n  ) +\n  geom_tile() +\n  scale_fill_viridis_c(guide = \"none\") +\n  theme_minimal() +\n  labs(x = \"Time (s)\", y = \"\")\n\n}\n\n\n\n\nLooking at Lucy Dacus’s “Night Shift” with EDM Key Profiles:\n\nedm_major_key &lt;- c(0.2949827,0.1842662, 0.2249348, 0.1796559, 0.2532545, 0.2391564, 0.2028676, 0.2607747, 0.1765553, 0.2105823, 0.1806760, 0.2562869)\n# \nedm_minor_key &lt;- c(0.3247214, 0.1767437, 0.2066454, 0.2482824, 0.1811887, 0.2263670, 0.1830838, 0.2662832, 0.2340293, 0.1888321, 0.2203257, 0.2047107)\nkey_plotter(\"1yYlpGuBiRRf33e1gY61bN\", edm_major_key, edm_minor_key)\n\n\n\n\nAnd here is the piece with the more traditional Krumhansl-Schmuckler key profiles:\n\nkey_plotter(\"1yYlpGuBiRRf33e1gY61bN\", ks_major_key, ks_minor_key)\n\n\n\n\nWe can load our “indie pop” but now in major and minor:\n\nplaylist &lt;- grab_playlist_info(\"37i9dQZF1DWWEcRhUVtL8n\")  \nindie_minor &lt;- playlist |&gt; filter(mode == 0)\nindie_major &lt;- playlist |&gt; filter(mode == 1)\nindie_minor &lt;- get_pitch_list(indie_minor)\nindie_major &lt;- get_pitch_list(indie_major)\n\nAnd then we put these weightings into the plotter:\n\nkey_plotter(\"1yYlpGuBiRRf33e1gY61bN\", ks_major_key, ks_minor_key)\n\n\n\n\n\n\n\n\nPick one piece and construct a genre-specific key-profile that might be used to explain its tonal make-up.\n\nExplain this musically."
  },
  {
    "objectID": "class_notes/week_4.html#why-is-key-finding-interesting",
    "href": "class_notes/week_4.html#why-is-key-finding-interesting",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "When we hear this ringtone, it sounds as though it’s in C, but why?\n\n\n\nNokia\n\n\n\nIt doesn’t begin with C, it begins with G.\nC isn’t the most common note–in fact, it only occurs once before the final bar, and it’s on the “and” of 2 in the third measure (a pretty weak position metrically).\nIs a key just whatever key the piece ends in? If we ended this on A, would it sound like it’s in A minor? It would be the same key signature, and we’d actually have a nice cadential ascent to the final A from the G in the third measure.\n\nSo what gives? Why do we hear this as being in C?\nPerhaps a follow-up question might simply be: what makes us hear something as being in a key?"
  },
  {
    "objectID": "class_notes/week_4.html#a-brief-history-of-key-finding",
    "href": "class_notes/week_4.html#a-brief-history-of-key-finding",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "This approach used what we might call an exclusionary approach, eliminating different key possibilities as pitch classes were introduced over the course of a musical passage.\nFor example, with the Nokia theme, the opening G would fit into seven major keys (G, C, D, F, B-flats, A-flat, E-flat;); six of those keys would include the opening two notes; and three of those six would still be possible when presented with the first three notes. By the end of the first measure, however, the only major key that would encompass all four melody notes would be C major. If more than one key was still available however, the algorithm would place more weight on the pitches present at the start of the piece. This worked quite well on pieces that were overtly tonal, but it was less effective for pieces that contained non-diatonic pitches (which is most pieces!)\n\n\n\nLonguet-Higgins and Steedman's 1971 Key-Finding Algorithm\n\n\n\n\n\nAs you might guess, the Longuet-Higgins and Steedman would miss a lot of musical instances. For example, pieces that have non-harmonic chords would struggle, as would pieces that had a lot of chromatic ornamentations. Ideally an algorithm would allow for these pitches to occur, but acknowledge that pitches in the key might be a better fit than those outside of the key, and that certain pitches in the key should be more heavily weighted than others.\nCarol Krumhansl and Mark Schmuckler (Krumhansl, 1990) would devise an algorithm that tallied up the pitch classes of an excerpt and compared the distribution of these pitch classes to ratings from an earlier probe-tone experiment. (Krumhansl and Kessler, 1982). The weightings can be seen below.\nWe might think of this as a correlational approach. We tally up all of the pitches in a corpus, and then run a correlation on this key-profile. We run this over all of the keys, and the one that best fits is then labeled as “the key”.\n\nlibrary(spotifyr)\nlibrary(compmus)\nlibrary(tidyverse)\nlibrary(purrr)\n\n\nks_major_key &lt;-\n  c(6.35, \n   2.23, \n   3.48, \n   2.33, \n   4.38, \n   4.09, \n   2.52, \n   5.19, \n   2.39, \n   3.66, \n   2.29, \n   2.88)\n\nks_minor_key &lt;-\n  c(6.33, \n  2.68, \n  3.52, \n  5.38, \n  2.60, \n  3.53, \n  2.54, \n  4.75, \n  3.98, \n  2.69, \n  3.34, \n  3.17)\n\nAn interesting distinction here is that of experiment-derived vs. corpus-derived weightings. Should a key-finding algorithm intend to match how we hear key in a controlled lab environment (with basic harmonic progression stimuli), or should they use real music as a starting point? If they use real music, which music?\n\n\n\nHector Bellman created a key-finding algorithm that used Helen Budge’s dissertation from the 1940s as a starting point. Budge tallied up note occurrences in composers from the classical music canon, looking at the tonal makeup of a large collection of pieces. Bellman then used these frequencies as the starting point for his own key-finding algorithm.\n\nmajor &lt;- c(16.80, \n            0.86,\n            12.95,\n            1.41,\n            13.49,\n            11.93,\n            1.25,\n            20.28,\n            1.80,\n            8.04,\n            0.62,\n            10.57)\n\nminor &lt;- c(18.16,\n            0.69,\n            12.99,\n            13.34,\n            1.07,\n            11.15,\n            1.38,\n            21.07,\n            7.49,\n            1.53,\n            0.92,\n            10.21)\n\n\n\n\nDavid Temperley (2001) also employed Western classical music as a starting point for his early key-finding work (not to be confused with his more dynamic Bayesian-informed later work). He used examples from a commonly used music theory textbook (Stefan Kostka and Dorothy Payne’s Tonal Harmony).\n\nmajor &lt;- c(0.748, \n            0.060, \n            0.488,\n            0.082, \n            0.670, \n            0.460, \n            0.096, \n            0.715, \n            0.104, \n            0.366,\n            0.057, \n            0.400)\n\nminor &lt;- c(0.712, \n            0.084, \n            0.474, \n            0.618, \n            0.049, \n            0.460, \n            0.105, \n            0.747, \n            0.404, \n            0.067, \n            0.133, \n            0.330)\n\n\n\n\nBret Aarden (2003) argued that folk music would be a better fit than those generated from classical music. He used the Essen Folksong collection (consisting of thousands of folksongs throughout Europe, although with an uneven balance toward German folksong), to come up with the weightings below.\n\nmajor &lt;- c(17.7661, \n            0.145624, \n            14.9265, \n            0.160186, \n            19.8049, \n            11.3587, \n            0.291248, \n            22.062, \n            0.145624, \n            8.15494, \n            0.232998, \n            4.95122)\n            \nminor &lt;- c(18.2648, \n            0.737619, \n            14.0499, \n            16.8599, \n            0.702494, \n            14.4362, \n            0.702494, \n            18.6161, \n            4.56621, \n            1.93186, \n            7.37619, \n            1.75623)\n\n\n\n\nCraig Sapp argued that we probably didn’t even need to get frequencies from corpora or experiments. If we just assume that the tonic and the dominant (scale degrees 1 and 5) are the most important, and the other pitches in the key are less important, but more important than those not in the key, then we have a pretty simple weighting system (that works quite well!).\n\nmajor &lt;- c(2, 0, 1, 0, 1, 1, 0, 2, 0, 1, 0, 1)\n\nminor &lt;- c(2, 0, 1, 1, 0, 1, 0, 2, 1, 0, 0.5, 0.5)\n\n\n\n\nJosh Albrecht and I tried our hands at this problem, and picked a set of classical works from the Humdrum corpus, looking at only the first and last eight measures of each. The numbers are below.\n\nmajor &lt;- c(0.238, \n            0.006, \n            0.111, \n            0.006, \n            0.137, \n            0.094, \n            0.016, \n            0.214, \n            0.009, \n            0.080, \n            0.008, \n            0.081) \n\nminor &lt;- c(0.220, \n            0.006, \n            0.104, \n            0.123, \n            0.019, \n            0.103, \n            0.012, \n            0.214, \n            0.062, \n            0.022, \n            0.061, \n            0.052)\n\nWe also tried a Euclidean distance approach, rather than a correlational approach.\nWe tried to explain it as follows:\n\nIn a two-dimensional space, if there were 70% of pitch X and 30% pitch Y, the Cartesian location of the point representing this pitch-class distribution would be at X 1⁄4 0.7 and Y 1⁄4 0.3. In this case, we are examining the distribution of 12 pitch classes, resulting in a 12-dimensional Cartesian space. The pitch-class distribution of each piece is represented by a point in that 12-dimensional space. The distance is then measured between this point and the 24 points representing the 12 major and 12 minor key pitch-class distributions, and the key separated by the shortest distance is taken to be the key of the work.\n\nBelow is a table comparing how well this did to the others.\n\n\n\nComparing the Albrecht and Shanahan to others\n\n\n\n\n\nThey each perform a bit differently on different types of tasks.\n\n\n\nComparing key-finding algorithms in major, minor, and overall (from Albrecht and Shanahan, 2013)"
  },
  {
    "objectID": "class_notes/week_4.html#analyzing-key-with-music21",
    "href": "class_notes/week_4.html#analyzing-key-with-music21",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "music21 has a number of built-in key-finding algorithms, and it’s nice to be able to compare keys in specific pieces. You can start to see the differences between them, and their respective biases.\nThis code will grab all of the files in a folder (here a number of Yugoslav folk songs):\n\nimport glob\n\n###change this path to be your own!\ndef filebrowser(ext=\"/Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/*.krn\"):\n    \"Returns files with an extension\"\n    return [f for f in glob.glob(ext)]\n\nfile_list = filebrowser()\n\nAnd here I will grab the key of each one and print it out using different algorithms:\n\nfrom music21 import *\nfor kern_file in file_list:\n\n  melody = converter.parse(kern_file)       \n  krum = analysis.discrete.KrumhanslKessler(melody)\n  krum_key = krum.getSolution(melody)\n  \n  aarden = analysis.discrete.AardenEssen(melody)\n  aarden_key = aarden.getSolution(melody)\n\n  bellman = analysis.discrete.BellmanBudge(melody)\n  bellman_key = bellman.getSolution(melody)\n\n  temperley = analysis.discrete.TemperleyKostkaPayne(melody)\n  temperley_key = temperley.getSolution(melody)\n\n  sapp = analysis.discrete.SimpleWeights(melody)\n  sapp_key = sapp.getSolution(melody)\n\nAnd then we can call all of our variables like so:\n\n  print(f'File name: {kern_file}\\nKrumhansl-Kessler: {krum_key}\\nAarden Essen: {aarden_key}\\nBellman-Budge: {bellman_key}\\nTemperley-Kostka-Payne: {temperley_key}\\nSapp Simple-Weightings: {sapp_key}\\n')\n\nThis returns the following results (with a very long list):\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos039.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos005.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: D major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos011.krn\nKrumhansl-Kessler: D major\nAarden Essen: D major\nBellman-Budge: D major\nTemperley-Kostka-Payne: D major\nSapp Simple-Weightings: D major\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos010.krn\nKrumhansl-Kessler: A- major\nAarden Essen: A- major\nBellman-Budge: A- major\nTemperley-Kostka-Payne: A- major\nSapp Simple-Weightings: C# major\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos004.krn\nKrumhansl-Kessler: F major\nAarden Essen: g minor\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: B- major\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos038.krn\nKrumhansl-Kessler: G major\nAarden Essen: e minor\nBellman-Budge: e minor\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos012.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: C major\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos006.krn\nKrumhansl-Kessler: C major\nAarden Essen: C major\nBellman-Budge: C major\nTemperley-Kostka-Payne: C major\nSapp Simple-Weightings: C major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos007.krn\nKrumhansl-Kessler: F major\nAarden Essen: B- major\nBellman-Budge: B- major\nTemperley-Kostka-Payne: B- major\nSapp Simple-Weightings: F major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos013.krn\nKrumhansl-Kessler: D major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos017.krn\nKrumhansl-Kessler: A- major\nAarden Essen: f minor\nBellman-Budge: f minor\nTemperley-Kostka-Payne: A- major\nSapp Simple-Weightings: A- major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos003.krn\nKrumhansl-Kessler: B major\nAarden Essen: E major\nBellman-Budge: E major\nTemperley-Kostka-Payne: E major\nSapp Simple-Weightings: B major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos002.krn\nKrumhansl-Kessler: F major\nAarden Essen: F major\nBellman-Budge: B- major\nTemperley-Kostka-Payne: B- major\nSapp Simple-Weightings: B- major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos016.krn\nKrumhansl-Kessler: D major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: D major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos014.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos028.krn\nKrumhansl-Kessler: a minor\nAarden Essen: g minor\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: d minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos029.krn\nKrumhansl-Kessler: C major\nAarden Essen: C major\nBellman-Budge: C major\nTemperley-Kostka-Payne: C major\nSapp Simple-Weightings: C major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos015.krn\nKrumhansl-Kessler: G major\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos001.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos112.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos106.krn\nKrumhansl-Kessler: F major\nAarden Essen: F major\nBellman-Budge: B- major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: B- major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos066.krn\nKrumhansl-Kessler: g minor\nAarden Essen: g minor\nBellman-Budge: g minor\nTemperley-Kostka-Payne: g minor\nSapp Simple-Weightings: g minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos072.krn\nKrumhansl-Kessler: a minor\nAarden Essen: F major\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: F major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos099.krn\nKrumhansl-Kessler: G major\nAarden Essen: a minor\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos098.krn\nKrumhansl-Kessler: b minor\nAarden Essen: G major\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: e minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos073.krn\nKrumhansl-Kessler: a minor\nAarden Essen: F major\nBellman-Budge: F major\nTemperley-Kostka-Payne: F major\nSapp Simple-Weightings: d minor\n\n\n\n\nFile name: /Users/danielshanahan/gitcloud/Teaching/corpus-studies-2024/data/Essen/Jugoslav/jugos067.krn\nKrumhansl-Kessler: D major\nAarden Essen: e minor\nBellman-Budge: G major\nTemperley-Kostka-Payne: G major\nSapp Simple-Weightings: G major\n\nThis code will give us the key, and the confidence of each key, with different algorithms:\n\nimport pandas as pd\nfrom music21 import *\nkrum_kess = []\naarden_essen = []\ntemperley_kp = []\nbellman_budge = []\nsapp_weighted = []\n\ntitles = []\nfor file in file_list:\n  titles.append(file.split(\"/\")[-1])\n  melody = converter.parse(file) \n \n  krum = analysis.discrete.KrumhanslKessler(melody)\n  krum_key = krum.getSolution(melody)\n  coef_krum = round(krum_key.correlationCoefficient, 3)\n  krum_kess.append(f'{krum_key} ({coef_krum})')\n\n  aarden = analysis.discrete.AardenEssen(melody)\n  coef_aarden = round(aarden_key.correlationCoefficient, 3)\n  aarden_key = aarden.getSolution(melody)\n  aarden_essen.append(f'{aarden_key} ({coef_aarden})')\n  \n  bellman = analysis.discrete.BellmanBudge(melody)\n  bellman_key = bellman.getSolution(melody)\n  coef_bellman = round(bellman_key.correlationCoefficient, 3)\n  bellman_budge.append(f'{bellman_key} ({coef_bellman})')\n\n  sapp = analysis.discrete.SimpleWeights(melody)\n  sapp_key = sapp.getSolution(melody)\n  coef_sapp = round(sapp_key.correlationCoefficient, 3)\n  sapp_weighted.append(f'{sapp_key} ({coef_sapp})')\n  \n  temperley = analysis.discrete.TemperleyKostkaPayne(melody)\n  temperley_key = temperley.getSolution(melody)\n  coef_temperley = round(temperley_key.correlationCoefficient, 3)\n  temperley_kp.append(f'{temperley_key} ({coef_temperley})')\n\npd.set_option('max_rows', 371)\ndf = pd.DataFrame(list(zip(titles, krum_kess, aarden_essen, bellman_budge, sapp_weighted, temperley_kp)), columns= ['Chorale','Krumhansl-Kessler', 'Aarden-Essen', 'Bellman-Budge', 'Sapp Weighted', 'Temperley-KP'])\ndf\n\nHere is a table of each key decided by each algorithm:\n\n\n\n\n\n\n\n\n\nChorale\n\n\nKrumhansl-Kessler\n\n\nAarden-Essen\n\n\nBellman-Budge\n\n\nSapp Weighted\n\n\nTemperley-KP\n\n\n\n\n\n\n0\n\n\njugos039.krn\n\n\nb minor (0.64)\n\n\nG major (0.848)\n\n\nG major (0.653)\n\n\ne minor (0.663)\n\n\nG major (0.693)\n\n\n\n\n1\n\n\njugos005.krn\n\n\nG major (0.765)\n\n\nG major (0.793)\n\n\nG major (0.79)\n\n\nD major (0.711)\n\n\nG major (0.827)\n\n\n\n\n2\n\n\njugos011.krn\n\n\nD major (0.839)\n\n\nD major (0.887)\n\n\nD major (0.757)\n\n\nD major (0.753)\n\n\nD major (0.839)\n\n\n\n\n3\n\n\njugos010.krn\n\n\nA- major (0.762)\n\n\nA- major (0.83)\n\n\nA- major (0.773)\n\n\nC# major (0.692)\n\n\nA- major (0.838)\n\n\n\n\n4\n\n\njugos004.krn\n\n\nF major (0.618)\n\n\ng minor (0.886)\n\n\nF major (0.727)\n\n\nB- major (0.686)\n\n\nF major (0.715)\n\n\n\n\n5\n\n\njugos038.krn\n\n\nG major (0.598)\n\n\ne minor (0.827)\n\n\ne minor (0.636)\n\n\nG major (0.587)\n\n\nG major (0.688)\n\n\n\n\n6\n\n\njugos012.krn\n\n\nG major (0.858)\n\n\nG major (0.727)\n\n\nG major (0.688)\n\n\nC major (0.716)\n\n\nG major (0.789)\n\n\n\n\n7\n\n\njugos006.krn\n\n\nC major (0.705)\n\n\nC major (0.753)\n\n\nC major (0.594)\n\n\nC major (0.582)\n\n\nC major (0.696)\n\n\n\n\n8\n\n\njugos007.krn\n\n\nF major (0.768)\n\n\nB- major (0.685)\n\n\nB- major (0.787)\n\n\nF major (0.801)\n\n\nB- major (0.82)\n\n\n\n\n9\n\n\njugos013.krn\n\n\nD major (0.822)\n\n\nG major (0.882)\n\n\nG major (0.859)\n\n\nG major (0.796)\n\n\nG major (0.826)\n\n\n\n\n10\n\n\njugos017.krn\n\n\nA- major (0.696)\n\n\nf minor (0.906)\n\n\nf minor (0.586)\n\n\nA- major (0.575)\n\n\nA- major (0.672)\n\n\n\n\n11\n\n\njugos003.krn\n\n\nB major (0.815)\n\n\nE major (0.683)\n\n\nE major (0.793)\n\n\nB major (0.817)\n\n\nE major (0.781)\n\n\n\n\n12\n\n\njugos002.krn\n\n\nF major (0.837)\n\n\nF major (0.858)\n\n\nB- major (0.828)\n\n\nB- major (0.884)\n\n\nB- major (0.806)\n\n\n\n\n13\n\n\njugos016.krn\n\n\nD major (0.829)\n\n\nG major (0.77)\n\n\nG major (0.843)\n\n\nD major (0.77)\n\n\nG major (0.851)\n\n\n\n\n14\n\n\njugos014.krn\n\n\nG major (0.797)\n\n\nG major (0.907)\n\n\nG major (0.784)\n\n\nG major (0.708)\n\n\nG major (0.857)\n\n\n\n\n15\n\n\njugos028.krn\n\n\na minor (0.547)\n\n\ng minor (0.902)\n\n\nF major (0.667)\n\n\nd minor (0.547)\n\n\nF major (0.659)\n\n\n\n\n16\n\n\njugos029.krn\n\n\nC major (0.64)\n\n\nC major (0.787)\n\n\nC major (0.616)\n\n\nC major (0.577)\n\n\nC major (0.682)\n\n\n\n\n17\n\n\njugos015.krn\n\n\nG major (0.744)\n\n\nG major (0.675)\n\n\nG major (0.611)\n\n\nG major (0.616)\n\n\nG major (0.709)\n\n\n\n\n18\n\n\njugos001.krn\n\n\nb minor (0.733)\n\n\nG major (0.688)\n\n\nG major (0.703)\n\n\ne minor (0.725)\n\n\nG major (0.809)\n\n\n\n\n19\n\n\njugos112.krn\n\n\nb minor (0.66)\n\n\nG major (0.84)\n\n\nG major (0.511)\n\n\ne minor (0.617)\n\n\nG major (0.576)\n\n\n\n\n20\n\n\njugos106.krn\n\n\nF major (0.872)\n\n\nF major (0.649)\n\n\nB- major (0.777)\n\n\nB- major (0.843)\n\n\nF major (0.795)\n\n\n\n\n21\n\n\njugos066.krn\n\n\ng minor (0.771)\n\n\ng minor (0.763)\n\n\ng minor (0.745)\n\n\ng minor (0.713)\n\n\ng minor (0.734)\n\n\n\n\n22\n\n\njugos072.krn\n\n\na minor (0.818)\n\n\nF major (0.734)\n\n\nF major (0.702)\n\n\nF major (0.566)\n\n\nF major (0.692)\n\n\n\n\n23\n\n\njugos099.krn\n\n\nG major (0.662)\n\n\na minor (0.773)\n\n\nG major (0.767)\n\n\nG major (0.719)\n\n\nG major (0.752)\n\n\n\n\n24\n\n\njugos098.krn\n\n\nb minor (0.697)\n\n\nG major (0.847)\n\n\nG major (0.499)\n\n\ne minor (0.568)\n\n\nG major (0.568)\n\n\n\n\n25\n\n\njugos073.krn\n\n\na minor (0.677)\n\n\nF major (0.642)\n\n\nF major (0.619)\n\n\nd minor (0.578)\n\n\nF major (0.648)\n\n\n\n\n26\n\n\njugos067.krn\n\n\nD major (0.619)\n\n\ne minor (0.746)\n\n\nG major (0.663)\n\n\nG major (0.628)\n\n\nG major (0.694)\n\n\n\n\n27\n\n\njugos107.krn\n\n\nG major (0.696)\n\n\nG major (0.718)\n\n\nG major (0.82)\n\n\nG major (0.708)\n\n\nG major (0.833)\n\n\n\n\n28\n\n\njugos113.krn\n\n\nG major (0.788)\n\n\nG major (0.932)\n\n\nG major (0.662)\n\n\nC major (0.699)\n\n\nG major (0.737)\n\n\n\n\n29\n\n\njugos105.krn\n\n\nG major (0.782)\n\n\nG major (0.678)\n\n\nG major (0.854)\n\n\nG major (0.745)\n\n\nG major (0.866)\n\n\n\n\n30\n\n\njugos111.krn\n\n\nG major (0.765)\n\n\nG major (0.943)\n\n\nG major (0.684)\n\n\nC major (0.719)\n\n\nG major (0.75)\n\n\n\n\n31\n\n\njugos059.krn\n\n\nF major (0.81)\n\n\nF major (0.723)\n\n\nF major (0.823)\n\n\nF major (0.729)\n\n\nF major (0.877)\n\n\n\n\n32\n\n\njugos071.krn\n\n\nF major (0.771)\n\n\nF major (0.929)\n\n\nF major (0.888)\n\n\nF major (0.82)\n\n\nF major (0.832)\n\n\n\n\n33\n\n\njugos065.krn\n\n\nF major (0.627)\n\n\nF major (0.908)\n\n\nF major (0.577)\n\n\nB- major (0.631)\n\n\nF major (0.662)\n\n\n\n\n34\n\n\njugos064.krn\n\n\ng minor (0.797)\n\n\ng minor (0.668)\n\n\ng minor (0.836)\n\n\ng minor (0.775)\n\n\ng minor (0.822)\n\n\n\n\n35\n\n\njugos070.krn\n\n\nF major (0.84)\n\n\nF major (0.824)\n\n\nF major (0.832)\n\n\nF major (0.822)\n\n\nF major (0.867)\n\n\n\n\n36\n\n\njugos058.krn\n\n\nF major (0.819)\n\n\nF major (0.901)\n\n\nF major (0.777)\n\n\nF major (0.709)\n\n\nF major (0.856)\n\n\n\n\n37\n\n\njugos110.krn\n\n\nC major (0.756)\n\n\nC major (0.89)\n\n\nC major (0.713)\n\n\nC major (0.791)\n\n\nC major (0.735)\n\n\n\n\n38\n\n\njugos104.krn\n\n\nG major (0.641)\n\n\ne minor (0.597)\n\n\ng minor (0.492)\n\n\nG major (0.568)\n\n\nG major (0.509)\n\n\n\n\n39\n\n\njugos100.krn\n\n\ng minor (0.691)\n\n\nC major (0.476)\n\n\nC major (0.626)\n\n\nc minor (0.652)\n\n\nc minor (0.558)\n\n\n\n\n40\n\n\njugos114.krn\n\n\nC major (0.861)\n\n\nF major (0.576)\n\n\nF major (0.798)\n\n\nC major (0.804)\n\n\nF major (0.741)\n\n\n\n\n41\n\n\njugos074.krn\n\n\nG major (0.636)\n\n\nG major (0.78)\n\n\nG major (0.647)\n\n\nG major (0.651)\n\n\nG major (0.651)\n\n\n\n\n42\n\n\njugos060.krn\n\n\ng minor (0.627)\n\n\nd minor (0.573)\n\n\nF major (0.621)\n\n\nB- major (0.586)\n\n\nF major (0.664)\n\n\n\n\n43\n\n\njugos048.krn\n\n\nF major (0.696)\n\n\nF major (0.687)\n\n\nF major (0.647)\n\n\nF major (0.589)\n\n\nF major (0.737)\n\n\n\n\n44\n\n\njugos049.krn\n\n\nA major (0.821)\n\n\nA major (0.754)\n\n\nA major (0.707)\n\n\nA major (0.74)\n\n\nA major (0.738)\n\n\n\n\n45\n\n\njugos061.krn\n\n\nC major (0.684)\n\n\nC major (0.716)\n\n\nF major (0.579)\n\n\nF major (0.68)\n\n\nC major (0.625)\n\n\n\n\n46\n\n\njugos075.krn\n\n\nG major (0.896)\n\n\nG major (0.54)\n\n\nG major (0.814)\n\n\nG major (0.837)\n\n\nG major (0.829)\n\n\n\n\n47\n\n\njugos115.krn\n\n\nG major (0.898)\n\n\nG major (0.835)\n\n\nG major (0.947)\n\n\nG major (0.939)\n\n\nG major (0.948)\n\n\n\n\n48\n\n\njugos101.krn\n\n\nG major (0.819)\n\n\nG major (0.958)\n\n\nG major (0.777)\n\n\nG major (0.709)\n\n\nG major (0.856)\n\n\n\n\n49\n\n\njugos117.krn\n\n\nC major (0.85)\n\n\nC major (0.89)\n\n\nC major (0.784)\n\n\na minor (0.765)\n\n\nC major (0.893)\n\n\n\n\n50\n\n\njugos103.krn\n\n\nG major (0.676)\n\n\nG major (0.862)\n\n\nG major (0.688)\n\n\nD major (0.62)\n\n\nG major (0.737)\n\n\n\n\n51\n\n\njugos063.krn\n\n\nF major (0.572)\n\n\nd minor (0.775)\n\n\nF major (0.561)\n\n\nB- major (0.524)\n\n\nF major (0.635)\n\n\n\n\n52\n\n\njugos077.krn\n\n\na minor (0.622)\n\n\na minor (0.648)\n\n\nG major (0.64)\n\n\nd minor (0.533)\n\n\na minor (0.581)\n\n\n\n\n53\n\n\njugos088.krn\n\n\na minor (0.622)\n\n\nD major (0.689)\n\n\nD major (0.545)\n\n\nD major (0.564)\n\n\nA major (0.439)\n\n\n\n\n54\n\n\njugos089.krn\n\n\na minor (0.594)\n\n\nG major (0.506)\n\n\nG major (0.544)\n\n\nC major (0.583)\n\n\nG major (0.619)\n\n\n\n\n55\n\n\njugos076.krn\n\n\nC major (0.828)\n\n\nC major (0.659)\n\n\nC major (0.733)\n\n\nC major (0.725)\n\n\nC major (0.809)\n\n\n\n\n56\n\n\njugos062.krn\n\n\nG major (0.603)\n\n\ne minor (0.812)\n\n\nG major (0.594)\n\n\nC major (0.597)\n\n\nG major (0.622)\n\n\n\n\n57\n\n\njugos102.krn\n\n\na minor (0.495)\n\n\nG major (0.57)\n\n\ne minor (0.577)\n\n\ne minor (0.54)\n\n\nG major (0.602)\n\n\n\n\n58\n\n\njugos116.krn\n\n\nG major (0.676)\n\n\nG major (0.651)\n\n\nG major (0.749)\n\n\ne minor (0.666)\n\n\nG major (0.774)\n\n\n\n\n59\n\n\njugos047.krn\n\n\nG major (0.835)\n\n\nC major (0.834)\n\n\nC major (0.861)\n\n\nC major (0.834)\n\n\nC major (0.861)\n\n\n\n\n60\n\n\njugos053.krn\n\n\nG major (0.903)\n\n\nG major (0.904)\n\n\nG major (0.786)\n\n\nG major (0.777)\n\n\nG major (0.859)\n\n\n\n\n61\n\n\njugos084.krn\n\n\nD major (0.65)\n\n\ne minor (0.859)\n\n\nG major (0.685)\n\n\nD major (0.665)\n\n\nG major (0.708)\n\n\n\n\n62\n\n\njugos090.krn\n\n\na minor (0.925)\n\n\na minor (0.695)\n\n\na minor (0.79)\n\n\na minor (0.774)\n\n\na minor (0.838)\n\n\n\n\n63\n\n\njugos091.krn\n\n\nE- major (0.711)\n\n\nE- major (0.868)\n\n\nE- major (0.666)\n\n\nE- major (0.632)\n\n\nE- major (0.726)\n\n\n\n\n64\n\n\njugos085.krn\n\n\nG major (0.639)\n\n\nG major (0.739)\n\n\nG major (0.772)\n\n\nG major (0.665)\n\n\nG major (0.805)\n\n\n\n\n65\n\n\njugos052.krn\n\n\nG major (0.769)\n\n\nG major (0.791)\n\n\nG major (0.701)\n\n\ne minor (0.708)\n\n\nG major (0.816)\n\n\n\n\n66\n\n\njugos046.krn\n\n\nG major (0.872)\n\n\nG major (0.839)\n\n\nG major (0.769)\n\n\nG major (0.772)\n\n\nG major (0.835)\n\n\n\n\n67\n\n\njugos118.krn\n\n\nb minor (0.878)\n\n\nG major (0.831)\n\n\nG major (0.801)\n\n\nG major (0.725)\n\n\nG major (0.86)\n\n\n\n\n68\n\n\njugos078.krn\n\n\ng minor (0.705)\n\n\ng minor (0.907)\n\n\nF major (0.565)\n\n\nB- major (0.567)\n\n\ng minor (0.607)\n\n\n\n\n69\n\n\njugos050.krn\n\n\nC major (0.82)\n\n\nF major (0.721)\n\n\nF major (0.951)\n\n\nF major (0.877)\n\n\nF major (0.894)\n\n\n\n\n70\n\n\njugos044.krn\n\n\nG major (0.853)\n\n\nG major (0.93)\n\n\nG major (0.86)\n\n\nG major (0.825)\n\n\nG major (0.865)\n\n\n\n\n71\n\n\njugos093.krn\n\n\nG major (0.729)\n\n\nG major (0.889)\n\n\nG major (0.657)\n\n\nG major (0.644)\n\n\nG major (0.712)\n\n\n\n\n72\n\n\njugos087.krn\n\n\na minor (0.585)\n\n\nG major (0.709)\n\n\nG major (0.55)\n\n\nC major (0.587)\n\n\nG major (0.611)\n\n\n\n\n73\n\n\njugos086.krn\n\n\nb- minor (0.794)\n\n\nb- minor (0.632)\n\n\nb- minor (0.505)\n\n\nb- minor (0.583)\n\n\nb- minor (0.554)\n\n\n\n\n74\n\n\njugos092.krn\n\n\nG major (0.621)\n\n\nG major (0.6)\n\n\nG major (0.686)\n\n\nD major (0.647)\n\n\nG major (0.727)\n\n\n\n\n75\n\n\njugos045.krn\n\n\nG major (0.546)\n\n\ne minor (0.791)\n\n\ne minor (0.652)\n\n\ne minor (0.56)\n\n\ne minor (0.687)\n\n\n\n\n76\n\n\njugos051.krn\n\n\ne minor (0.565)\n\n\nb minor (0.74)\n\n\nD major (0.566)\n\n\nG major (0.579)\n\n\nD major (0.589)\n\n\n\n\n77\n\n\njugos079.krn\n\n\nG major (0.837)\n\n\nG major (0.555)\n\n\nG major (0.903)\n\n\nG major (0.832)\n\n\nG major (0.924)\n\n\n\n\n78\n\n\njugos119.krn\n\n\nG major (0.778)\n\n\nG major (0.933)\n\n\nG major (0.778)\n\n\nG major (0.71)\n\n\nG major (0.858)\n\n\n\n\n79\n\n\njugos109.krn\n\n\nG major (0.637)\n\n\nG major (0.883)\n\n\nG major (0.668)\n\n\nG major (0.583)\n\n\nG major (0.748)\n\n\n\n\n80\n\n\njugos055.krn\n\n\nG major (0.868)\n\n\nG major (0.756)\n\n\nG major (0.816)\n\n\nG major (0.842)\n\n\nG major (0.796)\n\n\n\n\n81\n\n\njugos041.krn\n\n\nG major (0.482)\n\n\ne minor (0.814)\n\n\nG major (0.55)\n\n\nG major (0.547)\n\n\nG major (0.546)\n\n\n\n\n82\n\n\njugos069.krn\n\n\na minor (0.686)\n\n\nG major (0.532)\n\n\nG major (0.719)\n\n\nC major (0.607)\n\n\nG major (0.716)\n\n\n\n\n83\n\n\njugos096.krn\n\n\nG major (0.825)\n\n\nG major (0.805)\n\n\nG major (0.869)\n\n\nG major (0.815)\n\n\nG major (0.865)\n\n\n\n\n84\n\n\njugos082.krn\n\n\nG major (0.705)\n\n\nG major (0.904)\n\n\nG major (0.733)\n\n\nC major (0.609)\n\n\nG major (0.806)\n\n\n\n\n85\n\n\njugos083.krn\n\n\nD major (0.855)\n\n\nG major (0.864)\n\n\nG major (0.864)\n\n\nD major (0.8)\n\n\nG major (0.813)\n\n\n\n\n86\n\n\njugos097.krn\n\n\nG major (0.617)\n\n\nG major (0.885)\n\n\nG major (0.637)\n\n\nD major (0.631)\n\n\nG major (0.638)\n\n\n\n\n87\n\n\njugos068.krn\n\n\nG major (0.829)\n\n\nC major (0.666)\n\n\nC major (0.843)\n\n\nC major (0.77)\n\n\nC major (0.851)\n\n\n\n\n88\n\n\njugos040.krn\n\n\nb minor (0.753)\n\n\nG major (0.907)\n\n\nG major (0.68)\n\n\nD major (0.606)\n\n\nG major (0.673)\n\n\n\n\n89\n\n\njugos054.krn\n\n\nG major (0.838)\n\n\nG major (0.791)\n\n\nG major (0.824)\n\n\nG major (0.765)\n\n\nG major (0.869)\n\n\n\n\n90\n\n\njugos108.krn\n\n\na minor (0.504)\n\n\nd minor (0.905)\n\n\nd minor (0.585)\n\n\nd minor (0.553)\n\n\nd minor (0.566)\n\n\n\n\n91\n\n\njugos042.krn\n\n\nG major (0.66)\n\n\nG major (0.597)\n\n\nG major (0.628)\n\n\nC major (0.622)\n\n\nG major (0.733)\n\n\n\n\n92\n\n\njugos056.krn\n\n\nG major (0.874)\n\n\nG major (0.758)\n\n\nG major (0.854)\n\n\nG major (0.816)\n\n\nG major (0.874)\n\n\n\n\n93\n\n\njugos081.krn\n\n\nG major (0.79)\n\n\nG major (0.916)\n\n\nG major (0.762)\n\n\nG major (0.682)\n\n\nG major (0.848)\n\n\n\n\n94\n\n\njugos095.krn\n\n\nG major (0.792)\n\n\nG major (0.886)\n\n\nG major (0.771)\n\n\nG major (0.728)\n\n\nG major (0.836)\n\n\n\n\n95\n\n\njugos094.krn\n\n\ng minor (0.771)\n\n\ng minor (0.796)\n\n\ng minor (0.745)\n\n\ng minor (0.713)\n\n\ng minor (0.734)\n\n\n\n\n96\n\n\njugos080.krn\n\n\nG major (0.891)\n\n\nG major (0.734)\n\n\nC major (0.692)\n\n\nG major (0.738)\n\n\nG major (0.798)\n\n\n\n\n97\n\n\njugos057.krn\n\n\nF major (0.861)\n\n\nF major (0.754)\n\n\nF major (0.836)\n\n\nF major (0.776)\n\n\nF major (0.89)\n\n\n\n\n98\n\n\njugos043.krn\n\n\nb minor (0.735)\n\n\nG major (0.932)\n\n\nG major (0.823)\n\n\nD major (0.732)\n\n\nG major (0.855)\n\n\n\n\n99\n\n\njugos018.krn\n\n\nb- minor (0.807)\n\n\nb- minor (0.934)\n\n\nb- minor (0.551)\n\n\nb- minor (0.588)\n\n\nb- minor (0.587)\n\n\n\n\n100\n\n\njugos024.krn\n\n\nG major (0.824)\n\n\nG major (0.578)\n\n\nG major (0.873)\n\n\nG major (0.808)\n\n\nG major (0.895)\n\n\n\n\n101\n\n\njugos030.krn\n\n\nG major (0.793)\n\n\nG major (0.968)\n\n\nG major (0.837)\n\n\nG major (0.85)\n\n\nG major (0.848)\n\n\n\n\n102\n\n\njugos031.krn\n\n\nC major (0.797)\n\n\nF major (0.732)\n\n\nF major (0.823)\n\n\nC major (0.776)\n\n\nF major (0.804)\n\n\n\n\n103\n\n\njugos025.krn\n\n\nC major (0.908)\n\n\nC major (0.89)\n\n\nC major (0.831)\n\n\nC major (0.811)\n\n\nC major (0.894)\n\n\n\n\n104\n\n\njugos019.krn\n\n\na minor (0.611)\n\n\nf# minor (0.879)\n\n\na minor (0.53)\n\n\na minor (0.544)\n\n\na minor (0.504)\n\n\n\n\n105\n\n\njugos033.krn\n\n\nD major (0.664)\n\n\nG major (0.488)\n\n\nG major (0.667)\n\n\nG major (0.635)\n\n\nG major (0.602)\n\n\n\n\n106\n\n\njugos027.krn\n\n\ng minor (0.686)\n\n\nF major (0.685)\n\n\nF major (0.51)\n\n\nB- major (0.543)\n\n\nF major (0.549)\n\n\n\n\n107\n\n\njugos026.krn\n\n\nG major (0.895)\n\n\nG major (0.592)\n\n\nG major (0.805)\n\n\nG major (0.791)\n\n\nG major (0.87)\n\n\n\n\n108\n\n\njugos032.krn\n\n\nG major (0.936)\n\n\nG major (0.836)\n\n\nG major (0.878)\n\n\nG major (0.942)\n\n\nG major (0.913)\n\n\n\n\n109\n\n\njugos036.krn\n\n\nb minor (0.715)\n\n\nG major (0.853)\n\n\nG major (0.81)\n\n\nG major (0.726)\n\n\nG major (0.787)\n\n\n\n\n110\n\n\njugos022.krn\n\n\nD major (0.768)\n\n\nD major (0.88)\n\n\nD major (0.819)\n\n\nG major (0.781)\n\n\nD major (0.826)\n\n\n\n\n111\n\n\njugos023.krn\n\n\nC major (0.601)\n\n\nF major (0.883)\n\n\nF major (0.704)\n\n\nC major (0.639)\n\n\nF major (0.714)\n\n\n\n\n112\n\n\njugos037.krn\n\n\nG major (0.767)\n\n\nG major (0.822)\n\n\nG major (0.774)\n\n\nG major (0.724)\n\n\nG major (0.798)\n\n\n\n\n113\n\n\njugos021.krn\n\n\nD major (0.688)\n\n\ne minor (0.806)\n\n\nD major (0.739)\n\n\nG major (0.731)\n\n\nG major (0.762)\n\n\n\n\n114\n\n\njugos035.krn\n\n\nG major (0.881)\n\n\nG major (0.869)\n\n\nG major (0.952)\n\n\nG major (0.951)\n\n\nG major (0.938)\n\n\n\n\n115\n\n\njugos009.krn\n\n\nC major (0.762)\n\n\na minor (0.927)\n\n\nC major (0.752)\n\n\nC major (0.746)\n\n\nC major (0.814)\n\n\n\n\n116\n\n\njugos008.krn\n\n\nG major (0.896)\n\n\nG major (0.77)\n\n\nG major (0.806)\n\n\nG major (0.806)\n\n\nG major (0.872)\n\n\n\n\n117\n\n\njugos034.krn\n\n\nG major (0.897)\n\n\nG major (0.851)\n\n\nG major (0.779)\n\n\nG major (0.756)\n\n\nG major (0.866)\n\n\n\n\n118\n\n\njugos020.krn\n\n\nG major (0.888)\n\n\nG major (0.861)\n\n\nG major (0.86)\n\n\nG major (0.892)\n\n\nG major (0.897)\n\n\n\n\n\n\n\n\nHere, we can see the various windows of keys in a song:\n\nfor kern_file in file_list:\n  krum = analysis.discrete.KrumhanslKessler(kern_file)\n  krum_key = krum.getSolution(kern_file)\n  krum_key.correlationCoefficient\n  p = graph.plot.WindowedKey(kern_file.parts[0])\n  p.run()\n\nOne of these would look like this:\n\n\n\nWindowed analysis using the K-S algorithm"
  },
  {
    "objectID": "class_notes/week_4.html#audio-data",
    "href": "class_notes/week_4.html#audio-data",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "It might be worth having a look at some audio data now. For this, we will use the Spotify API and Ashley Burgoyne’s compmus package, and the spotifyr toolkit.\n\n\nIn order to explore the Spotify API, you will need a client ID and a client “secret”. You can find those here.\n\n\ncorrplot 0.92 loaded\n\n\n\ncircshift &lt;- function(v, n) {\n  if (n == 0) v else c(tail(v, n), head(v, -n))\n}\n# \n# # ### uses the Krumhansl Schmuckler Profiles\nmajor_key &lt;- c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)\nminor_key &lt;- c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)\n\n##sapp's simple weightings\n# major_key &lt;- c(2, 0, 1, 0, 1, 1, 0, 2, 0, 1, 0, 1)\n# \n# minor_key &lt;- c(2, 0, 1, 1, 0, 1, 0, 2, 1, 0, 0.5, 0.5)\n\nkey_templates &lt;-\n  tribble(\n    ~name, ~template,\n    \"Gb:maj\", circshift(major_key, 6),\n    \"Bb:min\", circshift(minor_key, 10),\n    \"Db:maj\", circshift(major_key, 1),\n    \"F:min\", circshift(minor_key, 5),\n    \"Ab:maj\", circshift(major_key, 8),\n    \"C:min\", circshift(minor_key, 0),\n    \"Eb:maj\", circshift(major_key, 3),\n    \"G:min\", circshift(minor_key, 7),\n    \"Bb:maj\", circshift(major_key, 10),\n    \"D:min\", circshift(minor_key, 2),\n    \"F:maj\", circshift(major_key, 5),\n    \"A:min\", circshift(minor_key, 9),\n    \"C:maj\", circshift(major_key, 0),\n    \"E:min\", circshift(minor_key, 4),\n    \"G:maj\", circshift(major_key, 7),\n    \"B:min\", circshift(minor_key, 11),\n    \"D:maj\", circshift(major_key, 2),\n    \"F#:min\", circshift(minor_key, 6),\n    \"A:maj\", circshift(major_key, 9),\n    \"C#:min\", circshift(minor_key, 1),\n    \"E:maj\", circshift(major_key, 4),\n    \"G#:min\", circshift(minor_key, 8),\n    \"B:maj\", circshift(major_key, 11),\n    \"D#:min\", circshift(minor_key, 3)\n  )\n\nLet’s look at Lucy Dacus’s “Night Shift”.\nThis grabs the track and does all the magic:\n\nnight_shift &lt;-\n  get_tidy_audio_analysis(\"1yYlpGuBiRRf33e1gY61bN\") |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  )\n\nAnd this is just a plotting function:\n\nnight_shift |&gt; \n  compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"euclidean\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n  ) |&gt;\n  ggplot(\n    aes(x = start + duration / 2, width = duration, y = name, fill = d)\n  ) +\n  geom_tile() +\n  scale_fill_viridis_c(guide = \"none\") +\n  theme_minimal() +\n  labs(x = \"Time (s)\", y = \"\")\n\n\n\n\n\nnight_shift &lt;-\n  get_tidy_audio_analysis(\"1yYlpGuBiRRf33e1gY61bN\") |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  )\n\nLet’s do some exercises:\n\nVisualize a song with all of these weightings.\n\nHow do the algorithms differ?\n\nCan you write a function that would call each weighting as an argument? What would that look like?"
  },
  {
    "objectID": "class_notes/week_4.html#making-our-own",
    "href": "class_notes/week_4.html#making-our-own",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "There are many different ways of calculating key, and what constitutes “tonality” can change quite a bit depending on how you approach it. If using a set of pitches from a corpus to define a key-profile, the question becomes “which corpus?”\nToday, we are going to look at what it means to generate a key-profile for more appropriate key-finding algorithms. We are going to break the class into a few separate sections:\n\nLooking at getting a broad key-profile from a playlist.\nBreaking that into a major and minor key-profile (and discussing the issues and implications with this)\nWorking on an in-class exercise that generates a key-profile from a corpus and then looks at"
  },
  {
    "objectID": "class_notes/week_4.html#whats-the-key-profile-for-indie-pop",
    "href": "class_notes/week_4.html#whats-the-key-profile-for-indie-pop",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "The basic code for getting a key-profile from a playlist is below. The process is as follows:\n\nGet the audio features from a playlist, and add the audio analysis onto the datafame.\nWe then create a “segments” column by using a map function from the tidyverse. Map functions basically apply a function over each element in a list. Here, we are saying “apply the compmus_c_transpose function to the key and segments lists from the add_audio_analysis function.”\n\nWhat does the compmus_c_transpose function do? It takes all of the chroma vectors and transposes them to the key of C, so that we can construct a single set of weightings from pieces in different keys.\n\nWe then only grab this transposed segments column and turn it into a more readable list with the unnest function.\n\nWe then grab the start, duration, and pitches info.\n\nWe then create a “pitches” column, and normalize these raw pitch counts. There are a few ways to do this, and there are different options for this.\nWe then used the compmus_gather_chroma function to take all of those chroma vectors and turn them into a list.\nWe then use the group_by and summarise functions from tidyverse, and get the mean count of each pitch class in the distribution.\n\n\n### grabs the key-profile of the indie-pop playlist.\nindie_pop_key_profile &lt;- get_playlist_audio_features(\"\", \"37i9dQZF1DWWEcRhUVtL8n\") |&gt;\n  add_audio_analysis() |&gt;\n  ## transpose all the chroma vectors to C.\n  mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n  ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n  select(segments) |&gt;\n  unnest(segments) |&gt; \n  select(start, duration, pitches) |&gt; \n  mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n  compmus_gather_chroma() |&gt;\n  group_by(pitch_class) |&gt;\n  summarise(mean_value = mean(value)) \n\nindie_pop_key_profile\n\nIdeally, we’d be able to turn this into a more reusable function. Below we’ve just turned made the playlist URI an argument:\n\nget_key_profile_broad &lt;- function(uri){\n   get_playlist_audio_features(\"\", uri) |&gt;\n   add_audio_analysis() |&gt;\n   ## transpose all the chroma vectors to C. (have I mentioned how great Burgoyne's library is??)\n   mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n   ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n   select(segments) |&gt;\n   unnest(segments) |&gt; \n   select(start, duration, pitches) |&gt; \n   mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n   compmus_gather_chroma() |&gt;\n   group_by(pitch_class) |&gt;\n   summarise(mean_value = median(value)) \n}\n\nAnd now we can just run the function like so:\n\nindie_pop &lt;- get_key_profile_broad(\"37i9dQZF1DWWEcRhUVtL8n\")\nindie_pop\n\nand we can plot it in a pretty straightforward way:\n\nbarplot(indie_pop$mean_value)\n\nSo we can look at other genres pretty easily. Here is me looking at Spotify’s “EDM 2023” playlist:"
  },
  {
    "objectID": "class_notes/week_4.html#whats-the-key-profile-for-edm",
    "href": "class_notes/week_4.html#whats-the-key-profile-for-edm",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "edm &lt;- get_key_profile_broad(\"37i9dQZF1DX1kCIzMYtzum\")\nedm\n\n# A tibble: 12 × 2\n   pitch_class mean_value\n   &lt;fct&gt;            &lt;dbl&gt;\n 1 C                0.250\n 2 C#|Db            0.142\n 3 D                0.182\n 4 D#|Eb            0.169\n 5 E                0.157\n 6 F                0.165\n 7 F#|Gb            0.145\n 8 G                0.228\n 9 G#|Ab            0.148\n10 A                0.154\n11 A#|Bb            0.152\n12 B                0.167\n\n\nand once again we can plot it:\n\nbarplot(edm$mean_value)\n\n\n\n\n\n\n\nFor both of these distributions, we see a strong showing for scale degrees 1 and 5 (they aren’t really labeled in these quickie plots, but it would be the first and seventh column, respectively).\nWith the “Indie Pop” plot, we see a strong showing of scale degrees 1 and 5, and are followed by the diatonic pitches, but with the “EDM” list, scale degrees 2, flat 3, and 3 occur with pretty much the same frequency. It might be worth splitting the major and minor pieces up a bit?"
  },
  {
    "objectID": "class_notes/week_4.html#getting-separate-major-and-minor-key-profiles",
    "href": "class_notes/week_4.html#getting-separate-major-and-minor-key-profiles",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "We could break this into a few parts for our own comfort. Let’s start by just creating a function that grabs the data. As that’s the one that’s quite time intensive, and calls to the API, let’s try to run it only once.\n\ngrab_playlist_info &lt;- function(uri){\n   get_playlist_audio_features(\"\", uri) |&gt;\n   add_audio_analysis() \n}\n\nOnce we have that in place, we can create a variable, and then subset it from there. Here, I’m saving the full list, and then creating a major and a minor variable.\n\nplaylist &lt;- grab_playlist_info(\"37i9dQZF1DX1kCIzMYtzum\")  \nminor &lt;- playlist |&gt; filter(mode == 0)\nmajor &lt;- playlist |&gt; filter(mode == 1)\n\n\nget_pitch_list &lt;- function(input){\n   input |&gt;     \n   mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n   ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n   select(segments) |&gt;\n   unnest(segments) |&gt; \n   select(start, duration, pitches) |&gt; \n   mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n   compmus_gather_chroma() |&gt;\n   group_by(pitch_class) |&gt;\n   summarise(mean_value = mean(value))\n}\n\nAnd now we can get separate pitch lists for major and minor:\n\nminor_key &lt;- get_pitch_list(minor)\nmajor_key &lt;- get_pitch_list(major)\n\nand then of course we can use these to inform our own key mapping.\nWe can start by putting this all into a super quick but inefficient function like this (hoping to improve it as we go along):\n\nkey_plotter &lt;- function(uri, major, minor){\n   major_key &lt;- major\n   minor_key &lt;- minor\n   key_templates &lt;-\n   tribble(\n      ~name, ~template,\n      \"Gb:maj\", circshift(major_key, 6),\n      \"Bb:min\", circshift(minor_key, 10),\n      \"Db:maj\", circshift(major_key, 1),\n      \"F:min\", circshift(minor_key, 5),\n      \"Ab:maj\", circshift(major_key, 8),\n      \"C:min\", circshift(minor_key, 0),\n      \"Eb:maj\", circshift(major_key, 3),\n      \"G:min\", circshift(minor_key, 7),\n      \"Bb:maj\", circshift(major_key, 10),\n      \"D:min\", circshift(minor_key, 2),\n      \"F:maj\", circshift(major_key, 5),\n      \"A:min\", circshift(minor_key, 9),\n      \"C:maj\", circshift(major_key, 0),\n      \"E:min\", circshift(minor_key, 4),\n      \"G:maj\", circshift(major_key, 7),\n      \"B:min\", circshift(minor_key, 11),\n      \"D:maj\", circshift(major_key, 2),\n      \"F#:min\", circshift(minor_key, 6),\n      \"A:maj\", circshift(major_key, 9),\n      \"C#:min\", circshift(minor_key, 1),\n      \"E:maj\", circshift(major_key, 4),\n      \"G#:min\", circshift(minor_key, 8),\n      \"B:maj\", circshift(major_key, 11),\n      \"D#:min\", circshift(minor_key, 3)\n  )\n\ntune &lt;-\n  get_tidy_audio_analysis(uri) |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  ) \n\ntune |&gt; compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"euclidean\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n  ) |&gt; \n  ggplot(\n    aes(x = start + duration / 2, width = duration, y = name, fill = d)\n  ) +\n  geom_tile() +\n  scale_fill_viridis_c(guide = \"none\") +\n  theme_minimal() +\n  labs(x = \"Time (s)\", y = \"\")\n\n}"
  },
  {
    "objectID": "class_notes/week_4.html#one-piece-and-many-key-profiles",
    "href": "class_notes/week_4.html#one-piece-and-many-key-profiles",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "Looking at Lucy Dacus’s “Night Shift” with EDM Key Profiles:\n\nedm_major_key &lt;- c(0.2949827,0.1842662, 0.2249348, 0.1796559, 0.2532545, 0.2391564, 0.2028676, 0.2607747, 0.1765553, 0.2105823, 0.1806760, 0.2562869)\n# \nedm_minor_key &lt;- c(0.3247214, 0.1767437, 0.2066454, 0.2482824, 0.1811887, 0.2263670, 0.1830838, 0.2662832, 0.2340293, 0.1888321, 0.2203257, 0.2047107)\nkey_plotter(\"1yYlpGuBiRRf33e1gY61bN\", edm_major_key, edm_minor_key)\n\n\n\n\nAnd here is the piece with the more traditional Krumhansl-Schmuckler key profiles:\n\nkey_plotter(\"1yYlpGuBiRRf33e1gY61bN\", ks_major_key, ks_minor_key)\n\n\n\n\nWe can load our “indie pop” but now in major and minor:\n\nplaylist &lt;- grab_playlist_info(\"37i9dQZF1DWWEcRhUVtL8n\")  \nindie_minor &lt;- playlist |&gt; filter(mode == 0)\nindie_major &lt;- playlist |&gt; filter(mode == 1)\nindie_minor &lt;- get_pitch_list(indie_minor)\nindie_major &lt;- get_pitch_list(indie_major)\n\nAnd then we put these weightings into the plotter:\n\nkey_plotter(\"1yYlpGuBiRRf33e1gY61bN\", ks_major_key, ks_minor_key)"
  },
  {
    "objectID": "class_notes/week_4.html#exercise",
    "href": "class_notes/week_4.html#exercise",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "",
    "text": "Pick one piece and construct a genre-specific key-profile that might be used to explain its tonal make-up.\n\nExplain this musically."
  },
  {
    "objectID": "class_notes/week_4.html#exploring-spotify",
    "href": "class_notes/week_4.html#exploring-spotify",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "Exploring Spotify",
    "text": "Exploring Spotify\nBy now, you should have an API key and secret. Also download the spotifyr package and the compmus package if you haven’t already."
  },
  {
    "objectID": "class_notes/week_4.html#grabbing-dans-discover-playlist",
    "href": "class_notes/week_4.html#grabbing-dans-discover-playlist",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "Grabbing Dan’s “Discover” Playlist",
    "text": "Grabbing Dan’s “Discover” Playlist\nThe first step will be to get the audio features of the playlist, and run it all into an audio analysis tool. Here’s what that will give us.\n\ndf &lt;- get_playlist_audio_features(\"\", \"37i9dQZEVXcIDdjTZ1FKnJ\") |&gt;\n  add_audio_analysis() \n\nThen we create a segments variable, and use the “c transpose” toolkit from compmus. I then take the segments, unnest it (it is a nested list), and then grab the pitches (and unnest that).\n\ndf |&gt; mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n  select(segments) |&gt; unnest(segments) |&gt; select(pitches) |&gt; unnest(pitches) |&gt; \n  head(12)\n\n# A tibble: 12 × 1\n   pitches\n     &lt;dbl&gt;\n 1   0.293\n 2   0.143\n 3   0.549\n 4   0.264\n 5   0.309\n 6   0.102\n 7   0.323\n 8   1    \n 9   0.331\n10   0.153\n11   0.181\n12   0.225\n\n\nHere, I’ve just taken a specific moment. This shows us that Spotify is the most confident the pitch “4” is this pitch at the moment we’re looking at.\nIf we want to grab the “key profile” of my playlist, we can use the following code:\n\n### grabs the key-profile of the indie-pop playlist.\ndf|&gt; \n  ## transpose all the chroma vectors to C.\n  mutate(segments = map2(segments, key, compmus_c_transpose)) |&gt;\n  ## grab the segments data and unnest it, then only grabbing the start, duration, and pitches info.\n  select(segments) |&gt;\n  unnest(segments) |&gt; \n  select(start, duration, pitches) |&gt; \n  mutate(pitches = map(pitches, compmus_normalise, \"euclidean\")) |&gt;\n  compmus_gather_chroma() |&gt;\n  group_by(pitch_class) |&gt;\n  summarise(mean_value = mean(value)) \n\ndans_discover\n\nNote how it grabs the audio, normalizes the pitches, grabs all of the chroma, and then runs a group_by and a summarise for each of the pitches.\n\nGetting the Key for Each Song\nThis will give us a list of keys and a sum of their weights. We can then take the list in descending order and grab one of them.\n\ntune &lt;-\n  get_tidy_audio_analysis(\"1yYlpGuBiRRf33e1gY61bN\") |&gt;\n  compmus_align(sections, segments) |&gt;\n  select(sections) |&gt;\n  unnest(sections) |&gt;\n  mutate(\n    pitches =\n      map(segments,\n          compmus_summarise, pitches,\n          method = \"mean\", norm = \"manhattan\"\n      )\n  ) \n\n    tune |&gt; compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"pearson\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n    ) |&gt; \n    group_by(name)  |&gt;\n    summarise(weight = sum(d)) |&gt; \n    arrange(weight)\n\n# A tibble: 24 × 2\n   name   weight\n   &lt;fct&gt;   &lt;dbl&gt;\n 1 A:maj    5.36\n 2 D:maj    7.22\n 3 D:min    9.56\n 4 F#:min   9.97\n 5 A:min   10.3 \n 6 B:min   12.0 \n 7 C#:min  12.0 \n 8 E:maj   12.9 \n 9 G:maj   13.5 \n10 E:min   15.3 \n# ℹ 14 more rows\n\n\nHere we want the lowest number, and it seems to make sense. This piece is in A major and perhaps D major? Our algorithm did a pretty good job.\n\nnight_shift &lt;- get_track_audio_features(\"1yYlpGuBiRRf33e1gY61bN\")\nnight_shift$key\n\n[1] 9\n\nnight_shift$mode\n\n[1] 1\n\n\nSpotify says it’s in A major!\nThe code above uses something called key_templates which (you might remember) we can define with out key profiles.\nSo we can add our own here! We start with the Krumansl-Schmuckler weightings, but here are Sapps as well (just comment out the first and uncomment the second).\n\nmajor_key &lt;- c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)\nminor_key &lt;- c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)\n\n#sapp's simple weightings\n# major_key &lt;- c(2, 0, 1, 0, 1, 1, 0, 2, 0, 1, 0, 1)\n# minor_key &lt;- c(2, 0, 1, 1, 0, 1, 0, 2, 1, 0, 0.5, 0.5)\n\nkey_templates &lt;-\n  tribble(\n    ~name, ~template,\n    \"Gb:maj\", circshift(major_key, 6),\n    \"Bb:min\", circshift(minor_key, 10),\n    \"Db:maj\", circshift(major_key, 1),\n    \"F:min\", circshift(minor_key, 5),\n    \"Ab:maj\", circshift(major_key, 8),\n    \"C:min\", circshift(minor_key, 0),\n    \"Eb:maj\", circshift(major_key, 3),\n    \"G:min\", circshift(minor_key, 7),\n    \"Bb:maj\", circshift(major_key, 10),\n    \"D:min\", circshift(minor_key, 2),\n    \"F:maj\", circshift(major_key, 5),\n    \"A:min\", circshift(minor_key, 9),\n    \"C:maj\", circshift(major_key, 0),\n    \"E:min\", circshift(minor_key, 4),\n    \"G:maj\", circshift(major_key, 7),\n    \"B:min\", circshift(minor_key, 11),\n    \"D:maj\", circshift(major_key, 2),\n    \"F#:min\", circshift(minor_key, 6),\n    \"A:maj\", circshift(major_key, 9),\n    \"C#:min\", circshift(minor_key, 1),\n    \"E:maj\", circshift(major_key, 4),\n    \"G#:min\", circshift(minor_key, 8),\n    \"B:maj\", circshift(major_key, 11),\n    \"D#:min\", circshift(minor_key, 3)\n  )\n\nIf I rerun this code with Sapp’s simple weightings, it thinks it’s in D major:\n\n    tune |&gt; compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"pearson\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n    ) |&gt; \n    group_by(name)  |&gt;\n    summarise(weight = sum(d)) |&gt; \n    arrange(weight)\n\n# A tibble: 24 × 2\n   name   weight\n   &lt;fct&gt;   &lt;dbl&gt;\n 1 A:maj    5.36\n 2 D:maj    7.22\n 3 D:min    9.56\n 4 F#:min   9.97\n 5 A:min   10.3 \n 6 B:min   12.0 \n 7 C#:min  12.0 \n 8 E:maj   12.9 \n 9 G:maj   13.5 \n10 E:min   15.3 \n# ℹ 14 more rows\n\n\nMaybe it is in D major?\nWhat if I use my indie pop profile?\n\nindie_pop_playlist &lt;- grab_playlist_info(\"37i9dQZF1DX1kCIzMYtzum\")  \nminor &lt;- indie_pop_playlist |&gt; filter(mode == 0)\nmajor &lt;- indie_pop_playlist |&gt; filter(mode == 1)\nindie_pop_minor &lt;- get_pitch_list(minor) |&gt; select(mean_value)\nindie_pop_major &lt;- get_pitch_list(major) |&gt; select(mean_value) \n\nI can take the key profiles given above and put them in the code below. While I’m at it though, I’m going to also grab the key profile from my discover playlist!\n\ndan_discover_playlist &lt;- grab_playlist_info(\"37i9dQZEVXcIDdjTZ1FKnJ\")  \nminor &lt;- dan_discover_playlist |&gt; filter(mode == 0)\nmajor &lt;- dan_discover_playlist |&gt; filter(mode == 1)\ndan_minor &lt;- get_pitch_list(minor) |&gt; select(mean_value)\ndan_major &lt;- get_pitch_list(major) |&gt; select(mean_value) \n\n\n# major_key &lt;- c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)\n# minor_key &lt;- c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)\n\n#sapp's simple weightings\n# major_key &lt;- c(2, 0, 1, 0, 1, 1, 0, 2, 0, 1, 0, 1)\n# minor_key &lt;- c(2, 0, 1, 1, 0, 1, 0, 2, 1, 0, 0.5, 0.5)\n\n## my indie pop profile\nmajor_key &lt;- as.numeric(unlist(indie_pop_major))\nminor_key &lt;- as.numeric(unlist(indie_pop_minor))\n\n## dan's discover playlist\n# major_key &lt;- as.numeric(unlist(dan_major))\n# minor_key &lt;- as.numeric(unlist(dan_minor))\n\n\nkey_templates &lt;-\n  tribble(\n    ~name, ~template,\n    \"Gb:maj\", circshift(major_key, 6),\n    \"Bb:min\", circshift(minor_key, 10),\n    \"Db:maj\", circshift(major_key, 1),\n    \"F:min\", circshift(minor_key, 5),\n    \"Ab:maj\", circshift(major_key, 8),\n    \"C:min\", circshift(minor_key, 0),\n    \"Eb:maj\", circshift(major_key, 3),\n    \"G:min\", circshift(minor_key, 7),\n    \"Bb:maj\", circshift(major_key, 10),\n    \"D:min\", circshift(minor_key, 2),\n    \"F:maj\", circshift(major_key, 5),\n    \"A:min\", circshift(minor_key, 9),\n    \"C:maj\", circshift(major_key, 0),\n    \"E:min\", circshift(minor_key, 4),\n    \"G:maj\", circshift(major_key, 7),\n    \"B:min\", circshift(minor_key, 11),\n    \"D:maj\", circshift(major_key, 2),\n    \"F#:min\", circshift(minor_key, 6),\n    \"A:maj\", circshift(major_key, 9),\n    \"C#:min\", circshift(minor_key, 1),\n    \"E:maj\", circshift(major_key, 4),\n    \"G#:min\", circshift(minor_key, 8),\n    \"B:maj\", circshift(major_key, 11),\n    \"D#:min\", circshift(minor_key, 3)\n  )\n\n    tune |&gt; compmus_match_pitch_template(\n    key_templates,         # Change to chord_templates if descired\n    method = \"pearson\",  # Try different distance metrics\n    norm = \"manhattan\"     # Try different norms\n    ) |&gt; \n    group_by(name)  |&gt;\n    summarise(weight = sum(d)) |&gt; \n    arrange(weight)\n\n# A tibble: 24 × 2\n   name   weight\n   &lt;fct&gt;   &lt;dbl&gt;\n 1 D:maj    6.62\n 2 A:maj    6.98\n 3 D:min    8.71\n 4 F#:min   9.99\n 5 A:min   10.4 \n 6 B:min   12.0 \n 7 G:maj   12.3 \n 8 C#:min  12.6 \n 9 E:min   13.3 \n10 C:maj   14.1 \n# ℹ 14 more rows\n\n\nSo this shows that my “indie pop” score agrees more with the Sapp simple weightings than either the Krumhansl Schmuckler or the Spotify algoithm. Indie Pop and Sapp think it’s D major, but Spotify and Krumhansl think A major. When I used my discover playlist, it also says A major (see below).\n\n   name   weight\n   &lt;fct&gt;   &lt;dbl&gt;\n 1 A:maj    5.75\n 2 D:maj    6.60\n 3 B:min    8.65\n 4 D:min   11.0 \n 5 F#:min  11.3 \n 6 C#:min  11.4 \n 7 A:min   12.1 \n 8 G:maj   12.2 \n 9 E:maj   15.1 \n10 E:min   15.5"
  },
  {
    "objectID": "class_notes/week_4.html#gold-medal-question",
    "href": "class_notes/week_4.html#gold-medal-question",
    "title": "Week 4: Conceptual Debates (Key-Finding, Entropy, etc.)",
    "section": "Gold Medal Question",
    "text": "Gold Medal Question\nCan you write a function that compares multiple keys given many profiles of a whole playlist?\nSteps: 1. Grab a playlist from Spotify 2. Grab the key profile 3. Include and argument that allows you to match keys with many key profiles. 4. Output this comparison as a table."
  }
]